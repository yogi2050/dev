<!doctype html> 
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--><html lang="en"><!--<![endif]-->

<!-- Mirrored from www.tutorialspoint.com/hibernate/hibernate_caching.htm by HTTrack Website Copier/3.x [XR&CO'2010], Sun, 14 Apr 2013 19:46:00 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8">
<title>Hibernate Caching</title>
<link rel="shortcut icon" href="../favicon.png" type="image/x-icon" />
<meta name="description" content="Hibernate, Tutorials, Learning, Beginners, Basics, Environment, Object Relational Mapping (ORM), Query Language, Native SQL, Caching, Interceptors, Persistent Classes, Persistent Objects, Collections, Associations and components, and Hibernate tools." />
<meta name="keywords" content="Hibernate Caching - Learn Hibernate 3.x starting from environment setup, Object Relational Mapping (ORM), Query Language, Native SQL, Caching, Interceptors, Persistent Classes, Persistent Objects, Collections, Associations and components, and Hibernate tools." />
<base  />
<link rel="stylesheet" type="text/css" href="../scripts/style.css" />
<link rel="stylesheet" type="text/css" href="../scripts/prettify.css" />
<script type="text/javascript" src="../scripts/prettify.js"></script>
<style media="screen" type="text/css">
#topmenu a:hover {text-decoration:none;color:#bcae79  !important;background-color:transparent;font-weight:bold;}
#header{ 
background:#bcae79  !important;
}
#topmenu
{
background-color:#59666c !important;
}
#leftcol ul.menu li.heading 
{
background:#bcae79 !important;
border:1px solid #59666c  !important;
}
#leftcol, #middlecol, #rightcol {min-height:1200px; padding:0px;}
</style>
<script src="../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-232293-6";
urchinTracker();
</script>
</head>
<body onload="prettyPrint()">
<div id="header">
<div class="wrapper">
<h1 class="logo"><a href="../index-2.html">Tutorials Point - Simply Easy Learning</a></h1>
<div id="search">
<form method="get" id="searchform" name="searchform" action="http://www.google.com/search" target="_blank">
<input type="hidden" name="sitesearch" value="www.tutorialspoint.com"/>
<input type="text" name="as_q" id="s" value="Search this site..." onfocus="if (this.value == 'Search this site...') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search this site...';}"/>
<input value="FORID:11" name="cof" type="hidden"/>
<input type="hidden" name="ie" value="ISO-8859-1" />
<input class="submit btn" type="image" src="../images/icon-search.png" alt="Go"/>
</form>
</div>
</div>
</div>
<div id="topmenu">
<div class="wrapper">
<div id="left">
<a href="../index-2.html" target="_top">HOME </a>
<a href="../java/index.html" target="_top">JAVA </a>
<a href="../php/index.html" target="_top">PHP </a>
<a href="../python/index.html" target="_top">Python </a>
<a href="../ruby/index.html" target="_top">Ruby </a>
<a href="../perl/index.html" target="_top">Perl </a>
<a href="../html/index.html" target="_top">HTML </a>
<a href="../css/index.html" target="_top">CSS </a>
<a href="../javascript/index.html" target="_top">Javascript </a>
<a href="../mysql/index.html" target="_top">MySQL </a>
<a href="../cplusplus/index.html" target="_top">C++ </a>
<a href="../unix/index.html" target="_top">UNIX </a>
<a href="../more.html" target="_top">MORE...</a>
</div>
<div id="right">
<a href="../references.html" target="_top">REFERENCES</a> |
<a href="../forums/index.html" target="_top">FORUM</a> |
<a href="../about/index.html" target="_top">ABOUT</a> |
<a href="../about/contact_us.html" target="_top">CONTACT</a>
</div>
</div>
</div>
<div class="wrapper">
<div id="leftcol">
<div class="mini-logo">
<img src="../images/hibernate-mini-logo.png" alt="Hibernate Tutorial" />
</div>
<ul class="menu">
<li class="heading">Hibernate Tutorial</li>
<li><a target="_top" href="index.html">Hibernate Home</a></li>
<li><a target="_top" href="orm_overview.html">ORM Overview</a></li>
<li><a target="_top" href="hibernate_overview.html">Hibernate Overview</a></li>
<li><a target="_top" href="hibernate_architecture.html">Hibernate Architecture</a></li>
<li><a target="_top" href="hibernate_environment.html">Hibernate Environment</a></li>
<li><a target="_top" href="hibernate_configuration.html">Hibernate Configuration</a></li>
<li><a target="_top" href="hibernate_sessions.html">Hibernate Sessions</a></li>
<li><a target="_top" href="hibernate_persistent_classes.html">Hibernate Persistent Class</a></li>
<li><a target="_top" href="hibernate_mapping_files.html">Hibernate Mapping Files</a></li>
<li><a target="_top" href="hibernate_mapping_types.html">Hibernate Mapping Types</a></li>
<li><a target="_top" href="hibernate_examples.html">Hibernate Examples</a></li>
<li><a target="_top" href="hibernate_or_mappings.html">Hibernate O/R Mappings</a></li>
<li><a target="_top" href="hibernate_annotations.html">Hibernate Annotations</a></li>
<li><a target="_top" href="hibernate_query_language.html">Hibernate Query Language</a></li>
<li><a target="_top" href="hibernate_criteria_queries.html">Hibernate Criteria Queries</a></li>
<li><a target="_top" href="hibernate_native_sql.html">Hibernate Native SQL</a></li>
<li><a target="_top" href="hibernate_caching.html"><b>Hibernate Caching</b></a></li>
<li><a target="_top" href="hibernate_batch_processing.html">Hibernate Batch Processing</a></li>
<li><a target="_top" href="hibernate_interceptors.html">Hibernate Interceptors</a></li>
</ul>
<ul class="menu">
<li class="heading">Hibernate Useful Resources</li>
<li><a target="_top" href="hibernate_quick_guide.html">Hibernate Quick Guide</a></li>
<li><a target="_top" href="hibernate_useful_resources.html">Hibernate Useful Resources</a></li>
</ul>
<ul class="menu">
<li class="sreading">Selected Reading</li>
<li><a target="_top" href="../developers_best_practices/index.html">Developer's Best Practices</a></li>
<li><a target="_top" href="../computer_glossary.html">Computer Glossary</a></li>
<li><a target="_top" href="../computer_whoiswho.html">Who is Who</a></li>
</ul>
</div><!-- leftcol -->
<div id="middlecol">
<!-- PRINTING STARTS HERE -->
<div class="content">
<h1>Hibernate Caching</h1>
<div class="topgooglead">
<div style="padding-bottom:5px;padding-left:10px;">Advertisements</div>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "image";
google_ad_channel = "";
//--></script>
<script type="text/javascript"
src="../../pagead2.googlesyndication.com/pagead/show_ads.js"> 
</script>
</div>
<hr />
<div class="pre-btn">
<a href="hibernate_native_sql.html">Previous Page</a>
</div>
<div class="nxt-btn">
<a href="hibernate_batch_processing.html">Next Page</a>
</div>
<div class="clearer"></div>
<hr />
<p>Caching is all about application performance optimization and it sits between your application and the database to avoid the number of database hits as many as possible to give a better performance for performance critical applications.</p>
<p>Caching is important to Hibernate as well which utilizes a multilevel caching schemes as explained below:</p>
<center>
<img src="../images/hibernate_cache.jpg" alt="Hibernate Caching" />
</center>
<h2>First-level cache:</h2> 
<p>The first-level cache is the Session cache and is a mandatory cache through which all requests must pass. The Session object keeps an object under its own power before committing it to the database.</p>
<p>If you issue multiple updates to an object, Hibernate tries to delay doing the update as long as possible to reduce the number of update SQL statements issued. If you close the session, all the objects being cached are lost and either persisted or updated in the database.</p>
<h2>Second-level cache:</h2> 
<p>Second level cache is an optional cache and first-level cache will always be consulted before any attempt is made to locate an object in the second-level cache. The second-level cache can be configured on a per-class and per-collection basis and mainly responsible for caching objects across sessions.</p>
<p>Any third-party cache can be used with Hibernate. An <b>org.hibernate.cache.CacheProvider</b> interface is provided, which must be implemented to provide Hibernate with a handle to the cache implementation.</p>
<h2>Query-level cache:</h2>
<p>Hibernate also implements a cache for query resultsets that integrates closely with the second-level cache.</p>
<p>This is an optional feature and requires two additional physical cache regions that hold the cached query results and the timestamps when a table was last updated. This is only useful for queries that are run frequently with the same parameters.</p>
<h2>The Second Level Cache:</h2>
<p>Hibernate uses first-level cache by default and you have nothing to do to use first-level cache. Let's go straight to the optional second-level cache. Not all classes benefit from caching, so it's important to be able to disable the second-level cache</p>
<p>The Hibernate second-level cache is set up in two steps. First, you have to decide which concurrency strategy to use. After that, you configure cache expiration and physical cache attributes using the cache provider.</p>
<h2>Concurrency strategies:</h2>
<p>A concurrency strategy is a mediator which responsible for storing items of data in the cache and retrieving them from the cache. If you are going to enable a second-level cache, you will have to decide, for each persistent class and collection, which cache concurrency strategy to use.</p>
<ul class="list">
<li><p><b>Transactional:</b> Use this strategy for read-mostly data where it is critical to prevent stale data in concurrent transactions,in the rare case of an update.</p></li>
<li><p><b>Read-write:</b> Again use this strategy for read-mostly data where it is critical to prevent stale data in concurrent transactions,in the rare case of an update.</p></li>
<li><p><b>Nonstrict-read-write:</b> This strategy makes no guarantee of consistency between the cache and the database. Use this strategy if data hardly ever changes and a small likelihood of stale data is not of critical concern.</p></li>
<li><p><b>Read-only:</b> A concurrency strategy suitable for data which never changes. Use it for reference data only.</p></li>
</ul>
<p>If we are going to use second-level caching for our <b>Employee</b> class, let us add the mapping element required to tell Hibernate to cache Employee instances using read-write strategy.</p>
<pre class="prettyprint">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC 
 "-//Hibernate/Hibernate Mapping DTD//EN"
 "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt; 

&lt;hibernate-mapping&gt;
   &lt;class name="Employee" table="EMPLOYEE"&gt;
      &lt;meta attribute="class-description"&gt;
         This class contains the employee detail. 
      &lt;/meta&gt;
      &lt;cache usage="read-write"/&gt;
      &lt;id name="id" type="int" column="id"&gt;
         &lt;generator class="native"/&gt;
      &lt;/id&gt;
      &lt;property name="firstName" column="first_name" type="string"/&gt;
      &lt;property name="lastName" column="last_name" type="string"/&gt;
      &lt;property name="salary" column="salary" type="int"/&gt;
   &lt;/class&gt;
&lt;/hibernate-mapping&gt;
</pre>
<p>The usage="read-write" attribute tells Hibernate to use a read-write concurrency strategy for the defined cache.</p>
<h2>Cache provider:</h2>
<p>Your next step after considering the concurrency strategies you will use for your cache candidate classes is to pick a cache provider. Hibernate forces you to choose a single cache provider for the whole application.</p>
<table class="src">
<tr><th style="width:5%">S.N.</th><th style="width:20%">Cache Name</th><th>Description</th></tr>
<tr><td>1</td><td>EHCache</td><td>It can cache in memory or on disk and clustered caching and it supports the optional Hibernate query result cache.</td></tr>
<tr><td>2</td><td>OSCache</td><td>Supports caching to memory and disk in a single JVM, with a rich set of expiration policies and query cache support.</td></tr>
<tr><td>3</td><td>warmCache</td><td>A cluster cache based on JGroups. It uses clustered invalidation but doesn't support the Hibernate query cache</td></tr>
<tr><td>4</td><td>JBoss Cache</td><td>A fully transactional replicated clustered cache also based on the JGroups multicast library. It supports replication or invalidation, synchronous
or asynchronous communication, and optimistic and pessimistic locking. The Hibernate query cache is supported</td></tr>
</table>
<p>Every cache provider is not compatible with every concurrency strategy. The following compatibility matrix will help you choose an appropriate combination.</p>
<table class="src">
<tr><th style="width:10%">Strategy/Provider</th><th>Read-only</th><th>Nonstrictread-write</th><th>Read-write</th><th>Transactional</th></tr>
<tr><td>EHCache</td><td>X</td><td>X</td><td>X</td><td>&nbsp;</td></tr>
<tr><td>OSCache</td><td>X</td><td>X</td><td>X</td><td>&nbsp;</td></tr>
<tr><td>SwarmCache</td><td>X</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td>JBoss Cache</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td></tr>
</table>
<p>You will specify a cache provider in hibernate.cfg.xml configuration file. We choose EHCache as our second-level cache provider:</p>
<pre class="prettyprint">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!DOCTYPE hibernate-configuration SYSTEM 
"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;

&lt;hibernate-configuration&gt;
   &lt;session-factory&gt;
   &lt;property name="hibernate.dialect"&gt;
      org.hibernate.dialect.MySQLDialect
   &lt;/property&gt;
   &lt;property name="hibernate.connection.driver_class"&gt;
      com.mysql.jdbc.Driver
   &lt;/property&gt;

   &lt;!-- Assume students is the database name --&gt;
   &lt;property name="hibernate.connection.url"&gt;
      jdbc:mysql://localhost/test
   &lt;/property&gt;
   &lt;property name="hibernate.connection.username"&gt;
      root
   &lt;/property&gt;
   &lt;property name="hibernate.connection.password"&gt;
      root123
   &lt;/property&gt;
   &lt;property name="hibernate.cache.provider_class">
      org.hibernate.cache.EhCacheProvider
   &lt;/property&gt;

   &lt;!-- List of XML mapping files --&gt;
   &lt;mapping resource="Employee.hbm.xml"/&gt;

&lt;/session-factory&gt;
&lt;/hibernate-configuration&gt;
</pre>
<p>Now, you need to specify the properties of the cache regions. EHCache has its own configuration file, <b>ehcache.xml</b>, which should be in the CLASSPATH of the application. A cache configuration in ehcache.xml for the Employee class may look like this:</p>
<pre class="prettyprint">
&lt;diskStore path="java.io.tmpdir"/&gt;
&lt;defaultCache
maxElementsInMemory="1000"
eternal="false"
timeToIdleSeconds="120"
timeToLiveSeconds="120"
overflowToDisk="true"
/&gt;

&lt;cache name="Employee"
maxElementsInMemory="500"
eternal="true"
timeToIdleSeconds="0"
timeToLiveSeconds="0"
overflowToDisk="false"
/&gt;
</pre>
<p>That's it, now we have second-level caching enabled for the Employee class and Hibernate now hits the second-level cache whenever you navigate to a Employee or when you load a Employee by identifier.</p>
<p>You should analyze your all the classes and choose appropriate caching strategy for each of the classes. Sometime, second-level caching may downgrade the performance of the application. So it is recommended to benchmark your application first without enabling caching and later on enable your well suited caching and check the performance. If caching is not improving system performance then there is no point in enabling any type of caching.</p>
<h2>The Query-level Cache:</h2>
<p>To use the query cache, you must first activate it using the <b>hibernate.cache.use_query_cache="true"</b> property in the configuration file. By setting this property to true, you make Hibernate create the necessary caches in memory to hold the query and identifier sets.</p>
<p>Next, to use the query cache, you use the setCacheable(Boolean) method of the Query class. For example:</p>
<pre class="prettyprint">
Session session = SessionFactory.openSession();
Query query = session.createQuery("FROM EMPLOYEE");
query.setCacheable(true);
List users = query.list();
SessionFactory.closeSession();
</pre>
<p>Hibernate also supports very fine-grained cache support through the concept of a cache region. A cache region is part of the cache that's given a name.</p>
<pre class="prettyprint">
Session session = SessionFactory.openSession();
Query query = session.createQuery("FROM EMPLOYEE");
query.setCacheable(true);
query.setCacheRegion("employee");
List users = query.list();
SessionFactory.closeSession();
</pre>
<p>This code uses the method to tell Hibernate to store and look for the query in the employee area of the cache.</p>
<hr />
<div class="pre-btn">
<a href="hibernate_native_sql.html">Previous Page</a>
</div>
<div class="print-btn">
<a href="../cgi-bin/printpage.html" target="_blank">Print Version</a>
</div>
<div class="pdf-btn">
<a href="pdf/hibernate_caching.pdf" alt="Hibernate Caching" target="_blank">PDF Version</a>
</div>
<div class="nxt-btn">
<a href="hibernate_batch_processing.html">Next Page</a>
</div>
<div class="clearer"></div>
<hr />
</div>
<!-- PRINTING ENDS HERE -->
<div class="bottomgooglead">
<div style="padding-bottom:5px;padding-left:10px;">Advertisements</div>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 336;
google_ad_height = 280;
google_ad_format = "336x280_as";
google_ad_type = "text";
google_ad_channel ="9030538898";
google_color_border="ffffff";
google_color_link="900b09";
google_color_url="000000";
google_color_text="000000";
//--></script>
<script type="text/javascript" src="../../pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</div>
</div><!-- middlecol -->
<div id="rightcol">
<!-- AddThis Button BEGIN -->
<div class="addthis">
<div class="addthis_toolbox addthis_default_style">
<a class="addthis_button_facebook"></a>
<a class="addthis_button_twitter"></a>
<script type="text/javascript">
<!--
 document.write('<a class="addthis_button_google_plusone" g:plusone:count="false"></a>');
//-->
</script>
<a class="addthis_button_linkedin"></a>
<a class="addthis_button_email"></a>
<a class="addthis_button_compact"></a>
</div>
<script type="text/javascript" src="../../s7.addthis.com/js/250/addthis_widget.js#pubid=ra-4f661ec623a400f0"></script>
</div>
<!-- AddThis Button END -->
<div class="localad">
<a rel="nofollow" href="http://www.modernindianbabynames.com/" target="_blank" title="Modern Baby Names">Modern Baby Names</a>
</div>
<div class="localad">
<a rel="nofollow" href="http://www.photofuntoos.com/" target="_blank" title="Online Photo Editing">Online Photo Editing</a>
</div>
<div class="rightgooglead">
<div style="padding-bottom:5px;padding-left:10px;">Advertisements</div>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "image";
google_ad_channel ="";
//--></script>
<script type="text/javascript"
src="../../pagead2.googlesyndication.com/pagead/show_ads.js"> 
</script>
</div>
</div><!-- rightcol -->
<div style="clear:both;"></div>
</div><!-- wrapper -->
<div id="footer">
<div class="wrapper">
<div id="bottommenu">
<a href="../asp.net/index.html" target="_top">ASP.NET </a> |
<a href="../jquery/index.html" target="_top">jQuery </a> |
<a href="../ajax/index.html" target="_top">AJAX </a> |
<a href="../ant/index.html" target="_top">ANT</a> |
<a href="../jsp/index.html" target="_top">JSP </a> |
<a href="../servlets/index.html" target="_top">Servlets </a> |
<a href="../log4j/index.html" target="_top">log4j </a> |
<a href="../ibatis/index.html" target="_top">iBATIS </a> |
<a href="index.html" target="_top">Hibernate </a> |
<a href="../jdbc/index.html" target="_top">JDBC </a> |
<a href="../struts_2/index.html" target="_top">Struts </a> |
<a href="../html5/index.html" target="_top">HTML5 </a> |
<a href="../sql/index.html" target="_top">SQL </a> |
<a href="../mysql/index.html" target="_top">MySQL </a> |
<a href="../cplusplus/index.html" target="_top">C++ </a> |
<a href="../unix/index.html" target="_top">UNIX </a>
</div>
<div id="copyright">
<p>Copyright &copy; 2012 by tutorialspoint. All Rights Reserved.</p>
</div>
</div>
</div>
</body>

<!-- Mirrored from www.tutorialspoint.com/hibernate/hibernate_caching.htm by HTTrack Website Copier/3.x [XR&CO'2010], Sun, 14 Apr 2013 19:46:04 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
</html>