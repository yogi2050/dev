<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<!-- Mirrored from www.tutorialspoint.com/ruby-on-rails/rails-file-uploading.htm by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 15 Apr 2013 05:01:15 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<title>File Uploading Using Rails</title>
<link rel="shortcut icon" href="../favicon.png" type="image/x-icon" />
<meta name="Keywords" content="Learning, Ruby, rails, strengths, framework, installation, examples, RubyGems, resources, Guide, actionpack, actionview, basics, directory, structure, advance, activerecord, libraries, Model, View, Controller, Embeded Ruby, Erb, Rolling, Metaprogramming,Built-in, testing, David, Black, Hansson, Heinemeier, RAA, Scaffolding" />
<meta name="Description" content="File Uploading Using Rails - Learn Ruby on Rails in simple and easy steps. You will learn its installation, framework, strengths with examples and you will learn about actionpack, actionview, activerecord, Heinemeier, Scaffolding, Controller, Heinemeier, Hansson, Rakefile etc." />
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="cache-control" content="no-cache" />
<base  />
<link rel="stylesheet" type="text/css" href="../tp.css" />
<script src="../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-232293-6";
urchinTracker();
</script>
</head>
<body>
<center>
<table border="0" class="main" cellpadding="2" cellspacing="0">
<tr>
<td class="content" valign="top" align="left">
<a href="../index-2.html"><img src="../images/tp-logo.gif" border="0"  alt="Tutorials Point" /></a>
<br />
<br />
<div  class="search">
<!-- SiteSearch Google -->
<form method="get" action="http://www.google.com/custom" target="google_window">
<table border="0">
<tr><td nowrap="nowrap" valign="top" align="center" height="32">
<a href="http://www.google.com/">
<img src="../../www.google.com/logos/Logo_25wht.gif" border="0" alt="Google" align="middle"></img></a>
</td>
</tr>
<tr>
<td nowrap="nowrap">
<input type="hidden" name="domains" value="www.tutorialspoint.com"></input>
<input type="text" name="q" size="20" maxlength="255" value=""></input>
<input type="submit" name="sa" style="width:20px;font-weight:bold" value="..."></input>
</td></tr>
<tr>
<td nowrap="nowrap">
<table>
<tr>
<td>
<input type="radio" name="sitesearch" value="" checked="checked"></input>
<font size="-1" color="#000000">Web</font>
</td>
<td>
<input type="radio" name="sitesearch" value="www.tutorialspoint.com"></input>
<font size="-1" color="#000000">This Site</font>
</td>
</tr>
</table>
<input type="hidden" name="client" value="pub-7133395778201029"></input>
<input type="hidden" name="forid" value="1"></input>
<input type="hidden" name="ie" value="ISO-8859-1"></input>
<input type="hidden" name="oe" value="ISO-8859-1"></input>
<input type="hidden" name="cof" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:336699;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;FORID:1"></input>
<input type="hidden" name="hl" value="en"></input>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</div>
<br />
&nbsp;&nbsp;<b>Learning Ruby on Rails</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="index.html">Rails Home</a></li>
<li><a class="left" target="_top" href="rails-introduction.html">Rails Introduction</a></li>
<li><a class="left" target="_top" href="rails-installation.html">Rails Installation</a></li>
<li><a class="left" target="_top" href="rails-framework.html">Rails Framework</a></li>
<li><a class="left" target="_top" href="rails-directory-structure.html">Rails Dir Structure</a></li>
<li><a class="left" target="_top" href="rails-examples.html">Rails Examples</a></li>
<li><a class="left" target="_top" href="rails-database-setup.html">Rails Database Setup</a></li>
<li><a class="left" target="_top" href="rails-active-records.html">Rails Active Records</a></li>
<li><a class="left" target="_top" href="rails-migrations.html">Rails Migrations</a></li>
<li><a class="left" target="_top" href="rails-controllers.html">Rails Controllers</a></li>
<li><a class="left" target="_top" href="rails-views.html">Rails Views</a></li>
<li><a class="left" target="_top" href="rails-layouts.html">Rails Layouts</a></li>
<li><a class="left" target="_top" href="rails-scaffolding.html">Rails Scaffolding</a></li>
<li><a class="left" target="_top" href="rails-and-ajax.html">Rails and AJAX</a></li>
<li><a class="left" target="_top" href="rails-file-uploading.html"><b>Rails Uploads File</a></b></li>
<li><a class="left" target="_top" href="rails-send-email.html">Rails Sends Email</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Ruby on Rails Quick Guide</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="rails-quick-guide.html" >Ruby on Rails Quick Guide</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Ruby Tutorial</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="../ruby/index-2.html" >Ruby Tutorial</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Ruby on Rails Resources</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="rails-resources.html" >Ruby on Rails Resources</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Selected Reading</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="../computer_glossary.html">Computer Glossary</a></li>
<li><a class="left" target="_top" href="../computer_whoiswho.html">Who is Who</a></li>
</ul>
</div>
<br /><br />
<small>&copy; 2013 TutorialsPoint.COM </small>
</td>
<td valign="top" align="left" width="100%">
<br /><br />
<table cellpadding="0" cellspacing="0">
<tr valign="middle">
<td  style="width:20px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../index-2.html">Home</a>&nbsp;&nbsp;
</td>
<td  style="width:20px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../references.html">References</a>&nbsp;&nbsp;
</td>
<td  style="width:20px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../forums/index.html">Discussion Forums</a>&nbsp;&nbsp;
</td>
<td  style="width:10px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../about/index.html">About TP</a>&nbsp;&nbsp;
</td>
</tr>
</table>
<table class="middle"  cellpadding="5" cellspacing="0">
<tr>
<td align="left">
<!-- PRINTING STARTS HERE -->
<h1>File Uploading using Rails</h1>
<hr />
<a href="rails-and-ajax.html"><img alt="previous" border="0" src="../images/previous.gif" /></a>
<a href="rails-send-email.html"><img alt="next" border="0" src="../images/next.gif" /></a>
<!-- AddThis Bookmark Button BEGIN -->
<a href="http://www.addthis.com/bookmark.php" rel="nofollow" onclick="addthis_url   = location.href; addthis_title = document.title; return addthis_click(this);" target="_blank"><img src="../images/add-this.gif" border="0" alt="AddThis Social Bookmark Button" /></a> <script type="text/javascript">var addthis_pub = 'tutorialspoint';</script><script type="text/javascript" src="http://s9.addthis.com/js/widget.php?v=10"></script>
<!-- AddThis Bookmark Button END -->
<br />
<br />
<hr/><div style="padding-bottom:5px;padding-left:10px;">Advertisements</div>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "image";
google_ad_channel = "";
//--></script>
<script type="text/javascript"
  src="../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<hr />
<p>You may have a requirement in which you want your site visitors to upload a file on your server. Rails makes it very easy to handle this requirement. Now we will proceed  with a simple and small Rails project.</p>
<p>As usual, let's start off with a new Rails application called <b>upload</b>. So let's create basic structure of the application by using simple rails command.</p>
<table cellpadding="5" class="src"><tr><td><pre>
C:\ruby&gt; rails upload
</pre></td></tr></table>
<p>Now let's decide where you would like to save your uploaded files. Assume this is <b>data</b> directory inside your public section. So create this directory and check the permissions.</p>
<table cellpadding="5" class="src"><tr><td><pre>
C:\ruby&gt; cd upload
C:\ruby&gt; mkdir upload\public\data
</pre></td></tr></table>
<p>Our next step will be as usual, to create controller and models, so let's do that:</p>
<h2>Creating Model:</h2>
<p>Because this is not a database based application so we can keep name whatever is comfortable to us. Assume we have to create a <b>DataFile</b> model.</p>
<table cellpadding="5" class="src"><tr><td><pre>
C:\ruby&gt; ruby script/generate model DataFile
      exists  app/models/
      exists  test/unit/
      exists  test/fixtures/
      create  app/models/data_file.rb
      create  test/unit/data_file_test.rb
      create  test/fixtures/data_files.yml
      create  db/migrate
      create  db/migrate/001_create_data_files.rb
</pre></td></tr></table>
<p>Now we will create a method called <b>save</b> in <b>data_file.rb</b> model file. This method will be called by the application controller.</p>
<table cellpadding="5" class="src"><tr><td><pre>
class DataFile &lt; ActiveRecord::Base
  def self.save(upload)
    name =  upload['datafile'].original_filename
    directory = "public/data"
    # create the file path
    path = File.join(directory, name)
    # write the file
    File.open(path, "wb") { |f| f.write(upload['datafile'].read) }
  end
end
</pre></td></tr></table>
<p>The above function will take CGI object <b>upload</b> and will extract uploaded file name using helper function <b>original_filename</b> and finally it will store uploaded file into "public/data" directory. You can call helper function <b>content_type</b> to know media type of the uploaded file.</p>
<p>Here <b>File</b> is a ruby object and join is a helper function will concatenate directory name alongwith file name and will return full file path.</p>
<p>Next, to open a file in write mode we are using open helper function provided by <b>File</b> object. Further we are reading data from the passed data file and writing into output file.</p>
<h2>Creating Controller:</h2>
<p>Now let's create a controller for our upload project:</p>
<table cellpadding="5" class="src"><tr><td><pre>
C:\ruby&gt; ruby script/generate controller Upload
      exists  app/controllers/
      exists  app/helpers/
      create  app/views/upload
      exists  test/functional/
      create  app/controllers/upload_controller.rb
      create  test/functional/upload_controller_test.rb
      create  app/helpers/upload_helper.rb
</pre></td></tr></table>
<p>Now we will create two controller functions first function <b>index</b> will call a view file to take user input and second function <b>uploadFile</b> takes file information from the user and passes it to the 'DataFile' model. We set the upload directory to the 'uploads' directory we created earlier "directory = 'data'".</p>
<table cellpadding="5" class="src"><tr><td><pre>
class UploadController &lt; ApplicationController
  def index
     render :file =&gt; 'app\views\upload\uploadfile.rhtml'
  end
  def uploadFile
    post = DataFile.save(params[:upload])
    render :text =&gt; "File has been uploaded successfully"
  end
end
</pre></td></tr></table>
<p>Here we are calling function defined in model file. The <b>render</b> function is being used to redirect to view file as well as to display a message.</p>
<h2>Creating View:</h2>
<p>Finally we will create a view file  <b>uploadfile.rhtml</b> which we have mentioned in controller. Populate this file with the following code:</p>
<table cellpadding="5" class="src"><tr><td><pre>
&lt;h1&gt;File Upload&lt;/h1&gt;
&lt;%= start_form_tag ({:action =&gt; 'uploadFile'}, 
                        :multipart =&gt; true) %&gt;
&lt;p&gt;&lt;label for="upload_file"&gt;Select File&lt;/label&gt; : 
&lt;%= file_field 'upload', 'datafile' %&gt;&lt;/p&gt;
&lt;%= submit_tag "Upload" %&gt;
&lt;%= end_form_tag %&gt;
</pre></td></tr></table>
<p>Here everything is same what we have explained in earlier chapters. Only new tag is <b>file_field</b> which will create a button to select a file from user's computer.</p>
<p>By setting the multipart parameter to true, you ensure that your action properly passes along the binary data from the file.</p>
<p>Here, an important point to note is that we have assigned <b>"uploadFile"</b> as the method name in :action, which will be called when you click the <b>Upload</b> button.</p>
<p>This will show you a screen as follows:</p>
<center>
<p><img src="../images/upload-file.html" alt="Upload File" style="border:1px dotted #aaa;" /></p>
</center>
<p>Now you select a file and upload it, this file will be uploaded into app/public/data directory with the actual file name and a message will be displayed to you saying that "File has been uploaded successfully".</p>
<p><b>NOTE:</b> If a file with the same name already exists in your output directory then it will be over-written.</p>
<h2>Files uploaded from Internet Explorer:</h2>
<p>Internet Explorer includes the entire path of a file in the filename sent, so the <b>original_filename</b> routine will return something like:</p>
<table cellpadding="5" class="src"><tr><td><pre>
C:\Documents and Files\user_name\Pictures\My File.jpg
</pre></td></tr></table>
<p>instead of just:</p>
<table cellpadding="5" class="src"><tr><td><pre>
My File.jpg
</pre></td></tr></table>
<p>This is easily handled by <b>File.basename</b>, which strips out everything before the filename.</p>
<table cellpadding="5" class="src"><tr><td><pre>
def sanitize_filename(file_name)
  # get only the filename, not the whole path (from IE)
  just_filename = File.basename(file_name) 
  # replace all none alphanumeric, underscore or perioids
  # with underscore
  just_filename.sub(/[^\w\.\-]/,'_') 
end
</pre></td></tr></table>
<h2>Deleting an existing File:</h2>
<p>If you want to delete any existing file then its simple and need to write following code:</p>
<table cellpadding="5" class="src"><tr><td><pre>
  def cleanup
    File.delete("#{RAILS_ROOT}/dirname/#{@filename}") 
            if File.exist?("#{RAILS_ROOT}/dirname/#{@filename}")
  end
</pre></td></tr></table>
<p>For a complete detail on <b>File</b> object, you need to go through Ruby Reference Manual.</p>
<hr />
<a href="rails-and-ajax.html"><img alt="previous" border="0" src="../images/previous.gif" /></a>
<a href="rails-send-email.html"><img alt="next" border="0" src="../images/next.gif" /></a>
<a href='../cgi-bin/printversion5fa5.html?tutorial=ruby-on-rails&amp;file=rails-file-uploading.htm' target="_blank">
<img src="../images/print.gif" alt="Printer Friendly" border="0" /></a>
<br />
<hr />
<!-- PRINTING ENDS HERE -->
<div style="padding-bottom:5px;padding-left:10px;">Advertisements</div>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 336;
google_ad_height = 280;
google_ad_format = "336x280_as";
google_ad_type = "text_image";
google_ad_channel ="9030538898";
google_color_border="ffffff";
google_color_link="900b09";
google_color_url="000000";
google_color_text="000000";
//--></script>
<script type="text/javascript" src="../../pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</td></tr>
</table>
</td>
<td class="right" align="center" valign="top">
<br /><br />
<table width="100%" cellpadding="0" cellspacing="0">
<tr valign="middle">
<td  class="top" style="border:0px;">
&nbsp;&nbsp;
</td>
</tr>
</table>
<table class="right"  cellpadding="0" cellspacing="0">
<tr>
<td align="center" class="right">
<p>
<u>Advertisements</u>
</p>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "image";
google_ad_channel ="";
//--></script>
<script type="text/javascript"
  src="../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<br /><br /></td></tr></table>
</td></tr></table>
</center>
</body>

<!-- Mirrored from www.tutorialspoint.com/ruby-on-rails/rails-file-uploading.htm by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 15 Apr 2013 05:01:15 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
</html>
