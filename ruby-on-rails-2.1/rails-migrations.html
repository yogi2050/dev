<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from www.tutorialspoint.com/ruby-on-rails-2.1/rails-migrations.htm by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 15 Apr 2013 05:01:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<title>Ruby on Rails 2.1.x Migrations</title>
<link rel="shortcut icon" href="../favicon.png" type="image/x-icon" />
<meta name="Keywords" content="Learning, Ruby, rails, strengths, framework, installation, examples, RubyGems, resources, Guide, actionpack, actionview, basics, directory, structure, advance, activerecord, libraries, Model, View, Controller, Embeded Ruby, Erb, Rolling, Metaprogramming,Built-in, testing, David, Black, Hansson, Heinemeier, RAA, Scaffolding" />
<meta name="Description" content="Ruby on Rails 2.1.x Migrations -  Learn Ruby on Rails in simple and easy steps using this Guide/Book/Reference Manual. You will learn its installation, framework, strengths with examples and you will learn about active resources, actionpack, actionview, activerecord, Heinemeier, Scaffolding, Controller, Heinemeier, Hansson etc." />
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="cache-control" content="no-cache" />
<base  />
<link rel="stylesheet" type="text/css" href="../tp.css" />
<script src="../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-232293-6";
urchinTracker();
</script>
</head>
<body>
<center>
<table border="0" class="main" cellpadding="2" cellspacing="0">
<tr>
<td class="content" valign="top" align="left">
<a href="../index-2.html"><img src="../images/tp-logo.gif" border="0"  alt="Tutorials Point" /></a>
<br />
<br />
<div  class="search">
<!-- SiteSearch Google -->
<form method="get" action="http://www.google.com/custom" target="google_window">
<table border="0">
<tr><td nowrap="nowrap" valign="top" align="center" height="32">
<a href="http://www.google.com/">
<img src="../../www.google.com/logos/Logo_25wht.gif" border="0" alt="Google" align="middle"></img></a>
</td>
</tr>
<tr>
<td nowrap="nowrap">
<input type="hidden" name="domains" value="www.tutorialspoint.com"></input>
<input type="text" name="q" size="20" maxlength="255" value=""></input>
<input type="submit" name="sa" style="width:20px;font-weight:bold" value="..."></input>
</td></tr>
<tr>
<td nowrap="nowrap">
<table>
<tr>
<td>
<input type="radio" name="sitesearch" value="" checked="checked"></input>
<font size="-1" color="#000000">Web</font>
</td>
<td>
<input type="radio" name="sitesearch" value="www.tutorialspoint.com"></input>
<font size="-1" color="#000000">This Site</font>
</td>
</tr>
</table>
<input type="hidden" name="client" value="pub-7133395778201029"></input>
<input type="hidden" name="forid" value="1"></input>
<input type="hidden" name="ie" value="ISO-8859-1"></input>
<input type="hidden" name="oe" value="ISO-8859-1"></input>
<input type="hidden" name="cof" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:336699;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;FORID:1"></input>
<input type="hidden" name="hl" value="en"></input>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</div>
<br />
&nbsp;&nbsp;<b>Learning Ruby on Rails 2.1</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="index.html">Rails 2.1 Home</a></li>
<li><a class="left" target="_top" href="rails-preliminary.html">Rails 2.1 Preliminary</a></li>
<li><a class="left" target="_top" href="rails-introduction.html">Rails 2.1 Introduction</a></li>
<li><a class="left" target="_top" href="rails-installation.html">Rails 2.1 Installation</a></li>
<li><a class="left" target="_top" href="rails-framework.html">Rails 2.1 Framework</a></li>
<li><a class="left" target="_top" href="rails-directory-structure.html">Rails 2.1 Dir Structure</a></li>
<li><a class="left" target="_top" href="rails-examples.html">Rails 2.1 Examples</a></li>
<li><a class="left" target="_top" href="rails-database-setup.html">Rails 2.1 Database Setup</a></li>
<li><a class="left" target="_top" href="rails-active-records.html">Rails 2.1 Active Records</a></li>
<li><a class="left" target="_top" href="rails-migrations.html"><b>Rails 2.1 Migrations</b></a></li>
<li><a class="left" target="_top" href="rails-controllers.html">Rails 2.1 Controllers</a></li>
<li><a class="left" target="_top" href="rails-views.html">Rails 2.1 Views</a></li>
<li><a class="left" target="_top" href="rails-layouts.html">Rails 2.1 Layouts</a></li>
<li><a class="left" target="_top" href="rails-scaffolding.html">Rails 2.1 Scaffolding</a></li>
<li><a class="left" target="_top" href="rails-and-ajax.html">Rails 2.1 and AJAX</a></li>
<li><a class="left" target="_top" href="rails-file-uploading.html">Rails 2.1 Uploads Files</a></li>
<li><a class="left" target="_top" href="rails-send-emails.html">Rails 2.1 Sends Emails</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Advanced Ruby on Rails 2.1</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="rails-and-rmagick.html">Rails 2.1 RMagick Guide</a></li>
<li><a class="left" target="_top" href="rails-http-basic-authentication.html">Rails 2.1 Basic HTTP Auth</a></li>
<li><a class="left" target="_top" href="rails-exception-handling.html">Rails 2.1 Error Handling</a></li>
<li><a class="left" target="_top" href="rails-routes.html">Rails 2.1 Routes System</a></li>
<li><a class="left" target="_top" href="rails-unit-testing.html">Rails 2.1 Unit Testing</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Ruby on Rails Quick Guide</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="rails-quick-guide.html" >Ruby on Rails Quick Guide</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Ruby Tutorial</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="../ruby/index-2.html" >Ruby Tutorial</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Ruby on Rails Resources</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="rails-resources.html" >Ruby on Rails Resources</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Selected Reading</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="../computer_glossary.html">Computer Glossary</a></li>
<li><a class="left" target="_top" href="../computer_whoiswho.html">Who is Who</a></li>
</ul>
</div>
<br /><br />
<small>&copy; 2013 TutorialsPoint.COM </small>
</td>
<td valign="top" align="left" width="100%">
<br /><br />
<table cellpadding="0" cellspacing="0">
<tr valign="middle">
<td  style="width:20px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../index-2.html">Home</a>&nbsp;&nbsp;
</td>
<td  style="width:20px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../references.html">References</a>&nbsp;&nbsp;
</td>
<td  style="width:20px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../forums/index.html">Discussion Forums</a>&nbsp;&nbsp;
</td>
<td  style="width:10px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../about/index.html">About TP</a>&nbsp;&nbsp;
</td>
</tr>
</table>
<table class="middle"  cellpadding="5" cellspacing="0">
<tr>
<td align="left">
<!-- PRINTING STARTS HERE -->
<h1>Ruby on Rails 2.1.x Migrations</h1>
<hr />
<a href="rails-active-records.html"><img alt="previous" border="0" src="../images/previous.gif" /></a>
<a href="rails-controllers.html"><img alt="next" border="0" src="../images/next.gif" /></a>
<!-- AddThis Bookmark Button BEGIN -->
<a href="http://www.addthis.com/bookmark.php" rel="nofollow" onclick="addthis_url   = location.href; addthis_title = document.title; return addthis_click(this);" target="_blank"><img src="../images/add-this.gif" border="0" alt="AddThis Social Bookmark Button" /></a> <script type="text/javascript">var addthis_pub = 'tutorialspoint';</script><script type="text/javascript" src="http://s9.addthis.com/js/widget.php?v=10"></script>
<!-- AddThis Bookmark Button END -->
<hr />
<hr/><div style="padding-bottom:5px;padding-left:10px;">Advertisements</div>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "image";
google_ad_channel = "";
//--></script>
<script type="text/javascript"
  src="../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<p>Rails Migration allows you to use Ruby to define changes to your database schema, making it possible to use a version control system to keep things synchronized  with the actual code.</p>
<p>This has many uses, including: </p>
<ul>
<li><p>Teams of developers - if one person makes a schema change, the other developers just need to update, and run "rake migrate".</p></li>
<li><p>Production servers - run "rake migrate" when you roll out a new release to bring the database up to date as well.</p></li>
<li><p>Multiple machines - if you develop on both a desktop and a laptop, or in more than one location, migrations can help you keep them all synchronized.</p></li>
</ul>
<h2>What can Rails Migration do?</h2>
<ul>
<li><p>create_table(name, options)</p></li>
<li><p>drop_table(name)</p></li>
<li><p>rename_table(old_name, new_name)</p></li>
<li><p>add_column(table_name, column_name, type, options)</p></li>
<li><p>rename_column(table_name, column_name, new_column_name)</p></li>
<li><p>change_column(table_name, column_name, type, options)</p></li>
<li><p>remove_column(table_name, column_name)</p></li>
<li><p>add_index(table_name, column_name, index_type)</p></li>
<li><p>remove_index(table_name, column_name)</p></li>
</ul>
<p><b>Migrations support all the basic data types:</b> string, text, integer, float, datetime, timestamp, time, date, binary and boolean:</p>
<ul>
<li><p><b>string -</b> is for small data types such as a title.</p></li>
<li><p><b>text  -</b> is for longer pieces of textual data, such as the description.</p></li>
<li><p><b>integer  -</b> is for whole numbers.</p></li>
<li><p><b>float  -</b> is for decimals.</p></li>
<li><p><b>datetime  and timestamp -</b>  store the date and time into a column.</p></li>
<li><p><b>date and time -</b> store either the date only or time only.</p></li>
<li><p><b>binary  -</b> is for storing data such as images, audio, or movies.</p></li>
<li><p><b>boolean -</b> is for storing true or false values.</p></li>
</ul>
<p>Valid column options are:</p>
<ul>
<li><p><strong>limit</strong> ( :limit =&gt; &#8220;50&#8221; )</p></li>
<li><p><strong>default</strong> (:default =&gt; &#8220;blah&#8221; )</p></li>
<li><p><strong>null</strong> (:null =&gt; false implies <span>NOT NULL</span>)</p></li>
</ul>
<p>The activities done by Rails Migration can be done using any front end GUI or direct on SQL prompt but Rails Migration makes all those activities very easy. Migrations are currently supported in MySQL, PostgreSQL, SQLite, SQL Server, Sybase, and Oracle.</p>
<p>See the <a target="_blank" href="http://api.rubyonrails.org/classes/ActiveRecord/Migration.html">Rails API</a> for details on these.</p>
<h1>Create the migrations:</h1>
<p>Here is the generic syntax for creating a migration:</p>
<table cellpadding="5" class="src"><tr><td><pre>
C:\ruby\application&gt; ruby script/generate migration table_name
</pre></td></tr></table>
<p>This will create the file db/migrate/001_table_name.rb. A migration file contains basic Ruby syntax that describes the data structure of a database table.</p>
<p><b>NOTE:</b> Before running migration generator, its recommended to clean existing migrations generated by model generators. Clean up your subdirectory ~\library\db\migrate before proceeding.</p>
<p>We will create two migrations corresponding to our three tables <b><i>books and subjects</i></b>.</p>
<table cellpadding="5" class="src"><tr><td><pre>
C:\ruby&gt; cd library
C:\ruby\library&gt; ruby script/generate migration books
C:\ruby\library&gt; ruby script/generate migration subjects
</pre></td></tr></table>
<p>Notice that you are using lower case for <i>book</i> and <i>subject</i> and using the plural form while creating migrations. This is a Rails paradigm that you should follow each time you create a Migration.</p>
<p>These above two commands will create following files in ~\library\db\migrate subdirectory:</p>
<table cellpadding="5" class="src"><tr><td><pre>
20080613163310_books.rb
20080613163416_subjects.rb
</pre></td></tr></table>
<p>Notice the number prefix for all the files. This is a time stamp used to create a unique file name. This may be different when you will create your migration files.</p>
<h1>Edit the code to tell it what to do?</h1>
<p>Go into db/migrate subdirectory of your application and edit each file one by one using any simple text editor.</p>
<p>Modify 20080613163310_books.rb as follows:</p>
<p>The ID column will be created automatically, so don't do it here as well.</p>
<table cellpadding="5" class="src"><tr><td><pre>
class Books &lt; ActiveRecord::Migration
  def self.up
     create_table :books do |t|
        t.string     :title, :limit =&gt; 32, :null =&gt; false
        t.float      :price
        t.integer    :subject_id
        t.text       :description
        t.timestamp  :created_at
     end
  end
  def self.down
    drop_table :books
  end
end
</pre></td></tr></table>
<p>The method <b>self.up</b> is used when migrating to a new version, <b>self.down</b> is used to roll back any changes if needed. At this moment above script will be used to create <b><i>books</i></b> table.</p>
<p>Modify 20080613163416_subjects.rb as follows:</p>
<table cellpadding="5" class="src"><tr><td><pre>
class Subjects &lt; ActiveRecord::Migration
   def self.up
       create_table :subjects do |t|
          t.string :name
       end
       Subject.create :name =&gt; "Physics"
       Subject.create :name =&gt; "Mathematics"
       Subject.create :name =&gt; "Chemistry"
       Subject.create :name =&gt; "Psychology"
       Subject.create :name =&gt; "Geography"
  end
  def self.down
      drop_table :subjects
  end
end
</pre></td></tr></table>
<p>Above script will be used to create <b><i>subjects</i></b> table and same time it will insert five records in the subjects table.</p>
<h1>Run the migration:</h1>
<p>Now you have created all the required migration files, its time to execute them against the database. To do this, go to a command prompt and go to the library directory, in which the application is located, and then type <b>rake migrate</b> command as follows:</p>
<table cellpadding="5" class="src"><tr><td><pre>
C:\ruby\library&gt; rake db:migrate
</pre></td></tr></table>
<p>This will create following three tables in <b>library_development</b> database:</p>
<ol>
<li><p>The <b>books</b> table if it doesn't exist.</p></li>
<li><p>The <b>subjects</b> table if it doesn't exist.</p></li>
<li><p>The <b>schema_migrations</b> table if it doesn't exist which tracks the current version of the database - each new migration will be a new version, and any new migrations will be run until your database is at the current version.</p></li>
</ol>
<p>For a detail of these table, login to your database and check all these tables.</p>
<p><b>Rake</b> is a Ruby build program similar to Unix <i>make</i> program that Rails takes advantage of to simplify the execution of complex tasks such as updating a database's structure etc.</p>
<h2>Running migrations for production and test databases:</h2>
<p>If you would like to specify what rails environment to use for the migration, use the RAILS_ENV shell variable.</p>
<p>For example:</p>
<table cellpadding="5" class="src"><tr><td><pre>
C:\ruby\library&gt; set RAILS_ENV=production
C:\ruby\library&gt; rake db:migrate
</pre></td></tr></table>
<br />
<table cellpadding="5" class="src"><tr><td><pre>
C:\ruby\library&gt; set RAILS_ENV=test
C:\ruby\library&gt; rake db:migrate
</pre></td></tr></table>
<br />
<table cellpadding="5" class="src"><tr><td><pre>
C:\ruby\library&gt; set RAILS_ENV=development
C:\ruby\library&gt; rake db:migrate
</pre></td></tr></table>
<p><b>NOTE:</b> On Unix, use "export RAILS_ENV=production" instead of <i>set</i> command.</p>
<h1>What is Next?</h1>
<p>Now we have our Database and required Tables available. In the two subsequent chapters we will explore two important components called Controller (ActionController) and View (ActionView).</p>
<ol>
<li>Creating Controllers ( Action Controller )</li>
<li>Creating Views ( Action View )</li>
</ol>
<br />
<hr />
<a href="rails-active-records.html"><img alt="previous" border="0" src="../images/previous.gif" /></a>
<a href="rails-controllers.html"><img alt="next" border="0" src="../images/next.gif" /></a>
<a href='../cgi-bin/printversione330.html?tutorial=ruby-on-rails-2.1&amp;file=rails-migrations.htm' target="_blank">
<img src="../images/print.gif" alt="Printer Friendly" border="0" /></a>
<br />
<hr />
<!-- PRINTING ENDS HERE -->
<div style="padding-bottom:5px;padding-left:10px;">Advertisements</div>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 336;
google_ad_height = 280;
google_ad_format = "336x280_as";
google_ad_type = "text_image";
google_ad_channel ="9030538898";
google_color_border="ffffff";
google_color_link="900b09";
google_color_url="000000";
google_color_text="000000";
//--></script>
<script type="text/javascript" src="../../pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</td></tr>
</table>
</td>
<td class="right" align="center" valign="top">
<br /><br />
<table width="100%" cellpadding="0" cellspacing="0">
<tr valign="middle">
<td  class="top" style="border:0px;">
&nbsp;&nbsp;
</td>
</tr>
</table>
<table class="right"  cellpadding="0" cellspacing="0">
<tr>
<td align="center" class="right">
<p>
<u>Advertisements</u>
</p>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "image";
google_ad_channel ="";
//--></script>
<script type="text/javascript"
  src="../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<br /><br /></td></tr></table>
</td></tr></table>
</center>
</body>

<!-- Mirrored from www.tutorialspoint.com/ruby-on-rails-2.1/rails-migrations.htm by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 15 Apr 2013 05:01:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
</html>
