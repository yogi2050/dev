<html>

<!-- Mirrored from www.tutorialspoint.com/dll/dll_writing.htm by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 15 Apr 2013 05:01:32 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<title>Writing Windows Dynamic Link Library (DLL)</title>
<link rel="shortcut icon" href="../favicon.png" type="image/x-icon" />
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta name="Keywords" content="SOAP,XML-RPC,Web Services, AJAX, VB.NET,.NET,  JAVA, J2EE, Unix Makefile,PERL,XSL,XHTML,ASP,ADO,VBScript,DOM,SQL,COLORS,PHP,CGI,Authoring,Programming,Training,Learning, Beginner's guide,Primer,Lessons,School,Howto,Reference,Examples,Samples,Source Code,Tags,Demos,Tips,Links,FAQ,Tag list,Forms,Frames,HTML Entities, HTML Color,w3c,Cascading Style Sheets, CSS, Active Server Pages, ASP, Dynamic Html,DHTML, C++, C#, C, Pro*C, Internet,Database,Development,Web building,Webmaster,Html Guide" />
<meta name="Description" content="Free tutorials and references for SOAP XML-RPC Web Services AJAX JavaScript J2EE ASP.NET VB.NET  C# C++ C Pro*C Makefile PERL Parrot Ruby JAVA J2EE CORBA BILLING CRM OM DLL PHP CGI MySQL PL/SQL SDLC CSS ASP DHTML Flash" />
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="cache-control" content="no-cache" />
<base >
<link rel="stylesheet" type="text/css" href="../tp.css" />
<script src="../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-232293-6";
urchinTracker();
</script>
</head>
<body>
<center>
<table border=0 class="main" cellpadding="2" cellspacing="0">
<tr>
<td class="content" valign="top" align="left">
<a href="../index-2.html"><img src="../images/tp-logo.gif" border=0  alt="Tutorials Point"></a>
<br>
<br>
<div  class="search">
<!-- SiteSearch Google -->
<form method="get" action="http://www.google.com/custom" target="google_window">
<table border="0">
<tr><td nowrap="nowrap" valign="top" align="center" height="32">
<a href="http://www.google.com/">
<img src="../../www.google.com/logos/Logo_25wht.gif" border="0" alt="Google" align="middle"></img></a>
</td>
</tr>
<tr>
<td nowrap="nowrap">
<input type="hidden" name="domains" value="www.tutorialspoint.com"></input>
<input type="text" name="q" size="18" maxlength="255" value=""></input>
<input type="submit" name="sa" style="width:20px;font-weight:bold" value="..."></input>
</td></tr>
<tr>
<td nowrap="nowrap">
<table>
<tr>
<td>
<input type="radio" name="sitesearch" value="" checked="checked"></input>
<font size="-1" color="#000000">Web</font>
</td>
<td>
<input type="radio" name="sitesearch" value="www.tutorialspoint.com"></input>
<font size="-1" color="#000000">This Site</font>
</td>
</tr>
</table>
<input type="hidden" name="client" value="pub-7133395778201029"></input>
<input type="hidden" name="forid" value="1"></input>
<input type="hidden" name="ie" value="ISO-8859-1"></input>
<input type="hidden" name="oe" value="ISO-8859-1"></input>
<input type="hidden" name="cof" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:336699;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;FORID:1"></input>
<input type="hidden" name="hl" value="en"></input>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</div>
<br>
&nbsp;&nbsp;<b>DLL Tutorial</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="index.html">DLL HOME</a></li>
<li><a class="left" target="_top" href="dll_introduction.html" >DLL Introduction</a></li>
<li><a class="left" target="_top" href="dll_writing.html" ><b>How to Write DLL</b></a></li>
<li><a class="left" target="_top" href="dll_registering.html" >Registering DLL</a></li>
<li><a class="left" target="_top" href="dll_tools.html" >Tools for DLL</a></li>
<li><a class="left" target="_top" href="dll_tips.html" >Tips on DLL</a></li>
</ul>
</div>
<br>
&nbsp;&nbsp;<b>DLL Examples</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="dll_examples.html" >DLL Examples</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Selected Reading</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="../computer_glossary.html">Computer Glossary</b></a></li>
<li><a class="left" target="_top" href="../computer_whoiswho.html">Who is Who</a></li>
</ul>
</div>
<br /><br />
<small>&copy; 2013 TutorialsPoint.COM </small>
</td>
<td valign="top">
<br><br>
<table cellpadding="0" cellspacing="0">
<tr valign="middle">
<td  style="width:20px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../index-2.html">Home</a>&nbsp;&nbsp;
</td>
<td  style="width:20px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../references.html">References</a>&nbsp;&nbsp;
</td>
<td  style="width:20px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../about/index.html">About TP</a>&nbsp;&nbsp;
</td>
<td  style="width:10px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../about/about_advertising.html">Advertising</a>&nbsp;&nbsp;
</td>
</tr>
</table>
<table class="middle"  cellpadding="5" cellspacing="0">
<tr>
<td>
<!-- PRINTING STARTS HERE -->
<h1>How to write Windows DLL</h1>
<a href="dll_introduction.html"><img alt="previous" border="0" src="../images/previous.gif" /></a>
<a href="dll_registering.html"><img alt="next" border="0" src="../images/next.gif" /></a>
<!-- AddThis Bookmark Button BEGIN -->
<a href="http://www.addthis.com/bookmark.php" rel="nofollow" onclick="addthis_url   = location.href; addthis_title = document.title; return addthis_click(this);" target="_blank"><img src="../images/add-this.gif" border="0" alt="AddThis Social Bookmark Button" /></a> <script type="text/javascript">var addthis_pub = 'tutorialspoint';</script><script type="text/javascript" src="http://s9.addthis.com/js/widget.php?v=10"></script>
<!-- AddThis Bookmark Button END -->
<br />
<br />
<hr/><div style="padding-bottom:5px;padding-left:10px;">Advertisements</div>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "image";
google_ad_channel = "";
//--></script>
<script type="text/javascript"
  src="../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<hr />
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td valign="middle">
<p>First we will discuss the issues and the requirements that you should consider when you develop your own DLLs.</p>
<h2>Types of DLLs</h2>
<p>When you load a DLL in an application, two methods of linking let you call the exported DLL functions. The two methods of linking are load-time dynamic linking and run-time dynamic linking.</p>

<b>Load-time dynamic linking </b>
<p>
In load-time dynamic linking, an application makes explicit calls to exported DLL functions like local functions. To use load-time dynamic linking, provide a header (.h) file and an import library (.lib) file when you compile and link the application. When you do this, the linker will provide the system with the information that is required to load the DLL and resolve the exported DLL function locations at load time. </p>
<b>Run-time dynamic linking </b> 
<p>
In run-time dynamic linking, an application calls either the LoadLibrary function or the LoadLibraryEx function to load the DLL at run time. After the DLL is successfully loaded, you use the GetProcAddress function to obtain the address of the exported DLL function that you want to call. When you use run-time dynamic linking, you do not need an import library file.</p>
<p>
The following list describes the application criteria for when to use load-time dynamic linking and when to use run-time dynamic linking:
</p>
<ul>
<li><b>Startup performance </b>
<p>If the initial startup performance of the application is important, you should use run-time dynamic linking.</p>

<li><b>Ease of use</b>
<p>In load-time dynamic linking, the exported DLL functions are like local functions. This makes it easy for you to call these functions.</p>
<li><b>Application logic</b>
</ul>
<p>In run-time dynamic linking, an application can branch to load different modules as required. This is important when you develop multiple-language versions.</p>
<hr>
<h2>The DLL entry point</h2>
<p>When you create a DLL, you can optionally specify an entry point function. The entry point function is called when processes or threads attach themselves to the DLL or detached themselves from the DLL. You can use the entry point function to initialize data structures or to destroy data structures as required by the DLL. Additionally, if the application is multithreaded, you can use thread local storage (TLS) to allocate memory that is private to each thread in the entry point function. The following code is an example of the DLL entry point function.</p>
<table class="ex" width="100%"<tr><td>
<pre>
BOOL APIENTRY DllMain(
HANDLE hModule,	// Handle to DLL module
	DWORD ul_reason_for_call,
	LPVOID lpReserved ) // Reserved
{
	switch ( ul_reason_for_call )
	{
		case DLL_PROCESS_ATTACHED:
		// A process is loading the DLL.
		break;
		case DLL_THREAD_ATTACHED:
		// A process is creating a new thread.
		break;
		case DLL_THREAD_DETACH:
		// A thread exits normally.
		break;
		case DLL_PROCESS_DETACH:
		// A process unloads the DLL.
		break;
	}
	return TRUE;
}
</pre>
</td></tr></table>
<p>When the entry point function returns a FALSE value, the application will not start if you are using load-time dynamic linking. If you are using run-time dynamic linking, only the individual DLL will not load.</p>

<p>The entry point function should only perform simple initialization tasks and should not call any other DLL loading or termination functions. For example, in the entry point function, you should not directly or indirectly call the <b>LoadLibrary</b> function or the <b>LoadLibraryEx</b> function. Additionally, you should not call the <b>FreeLibrary</b> function when the process is terminating.
</p>
<p><b>WARNING:</b> In multithreaded applications, make sure that access to the DLL global data is synchronized (thread safe) to avoid possible data corruption. To do this, use TLS to provide unique data for each thread.</p>
<hr>
<h2>Exporting DLL functions</h2>

<p>To export DLL functions, you can either add a function keyword to the exported DLL functions or create a module definition (.def) file that lists the exported DLL functions.</p>
<p>To use a function keyword, you must declare each function that you want to export with the following keyword:</p>
<table class="ex" width="100%"<tr><td>
<pre>
 __declspec(dllexport)</pre>
</td></tr></table>
<p>To use exported DLL functions in the application, you must declare each function that you want to import with the following keyword:</p>
<table class="ex" width="100%"<tr><td>
<pre>
 __declspec(dllimport)</pre>
</td></tr></table>
<p>Typically, you would use one header file that has a <b>define</b> statement and an <b>ifdef</b> statement to separate the export statement and the import statement.</p>

<p>You can also use a module definition file to declare exported DLL functions. When you use a module definition file, you do not have to add the function keyword to the exported DLL functions. In the module definition file, you declare the <b>LIBRARY</b> statement and the <b>EXPORTS</b> statement for the DLL. The following code is an example of a definition file. </p>
<table class="ex" width="100%"<tr><td>
<pre>
// SampleDLL.def
//
LIBRARY "sampleDLL"

EXPORTS
  HelloWorld
</pre>
</td></tr></table>
<hr>
<h2>Write Sample DLL</h2>
<p>In Microsoft Visual C++ 6.0, you can create a DLL by selecting either the <b>Win32 Dynamic-Link Library</b> project type or the <b>MFC AppWizard (dll)</b> project type.</p>

<p>The following code is an example of a DLL that was created in Visual C++ by using the Win32 Dynamic-Link Library project type. </p>
<table class="ex" width="100%"<tr><td>
<pre>
// SampleDLL.cpp
//

#include "stdafx.h"
#define EXPORTING_DLL
#include "sampleDLL.h"

BOOL APIENTRY DllMain( HANDLE hModule, 
                       DWORD  ul_reason_for_call, 
                       LPVOID lpReserved
					 )
{
    return TRUE;
}

void HelloWorld()
{
   MessageBox( NULL, TEXT("Hello World"), 
			TEXT("In a DLL"), MB_OK);
}
</pre>
</td></tr></table>
<br>
<table class="ex" width="100%"<tr><td>
<pre>
// File: SampleDLL.h
//
#ifndef INDLL_H
#define INDLL_H

#ifdef EXPORTING_DLL
extern __declspec(dllexport) void HelloWorld() ;
#else
extern __declspec(dllimport) void HelloWorld() ;
#endif

#endif
</pre>
</td></tr></table>
<hr>
<h2>Calling Sample DLL in your Program</h2>
<p>The following code is an example of a Win32 Application project that calls the exported DLL function in the SampleDLL DLL.</p>
<table class="ex" width="100%"<tr><td>
<pre>
// SampleApp.cpp 
//

#include "stdafx.h"
#include "sampleDLL.h"

int APIENTRY WinMain(HINSTANCE hInstance,
                     HINSTANCE hPrevInstance,
                     LPSTR     lpCmdLine,
                     int       nCmdShow)
{ 	
	HelloWorld();
	return 0;
}
</pre>
</td></tr></table>
<p><b>NOTE:</b> In load-time dynamic linking, you must link the SampleDLL.lib import library that is created when you build the SampleDLL project.

</p>
<p>
In run-time dynamic linking, you use code that is similar to the following code to call the SampleDLL.dll exported DLL function. </p>
<table class="ex" width="100%"<tr><td>
<pre>
...
typedef VOID (*DLLPROC) (LPTSTR);
...
HINSTANCE hinstDLL;
DLLPROC HelloWorld;
BOOL fFreeDLL;

hinstDLL = LoadLibrary("sampleDLL.dll");
if (hinstDLL != NULL)
{
    HelloWorld = (DLLPROC) GetProcAddress(hinstDLL,
					 "HelloWorld");
    if (HelloWorld != NULL)
        (HelloWorld);

    fFreeDLL = FreeLibrary(hinstDLL);
}
...
</pre>
</td></tr></table>
<p>When you compile and link the SampleDLL application, the Windows operating system searches for the SampleDLL DLL in the following locations in this order:
<ol>
<li>The application folder
<li>The current folder
<li>The Windows system folder<br>
<b>NOTE:</b> The <b>GetSystemDirectory</b> function returns the path of the Windows system folder.

<li>The Windows folder<br>
<b>NOTE:</b> The <b>GetWindowsDirectory</b> function returns the path of the Windows folder.
</ol>
</p>

</td>
</tr>
</table>
<hr />
<a href="dll_introduction.html"><img alt="previous" border="0" src="../images/previous.gif" /></a>
<a href="dll_registering.html"><img alt="next" border="0" src="../images/next.gif" /></a>
<a href='../cgi-bin/printversionda27.html?tutorial=dll&amp;file=dll_writing.htm' target="_blank">
<img src="../images/print.gif" alt="Printer Friendly" border="0" /></a>
<hr />
<br />
<!-- PRINTING ENDS HERE -->
<div style="padding-bottom:5px;padding-left:10px;">Advertisements</div>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 336;
google_ad_height = 280;
google_ad_format = "336x280_as";
google_ad_type = "text_image";
google_ad_channel ="9030538898";
google_color_border="ffffff";
google_color_link="900b09";
google_color_url="000000";
google_color_text="000000";
//--></script>
<script type="text/javascript" src="../../pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</td></tr>
</table>
</td>
<td class="right" align="center" valign="top">
<br /><br />
<table width="100%" cellpadding="0" cellspacing="0">
<tr valign="middle">
<td  class="top" style="border:0px;">
&nbsp;&nbsp;
</td>
</tr>
</table>
<table class="right"  cellpadding="0" cellspacing="0">
<tr>
<td align="center" class="right">
<p>
<u>Advertisements</u>
</p>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "image";
google_ad_channel ="";
//--></script>
<script type="text/javascript"
  src="../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<br /><br /></td></tr></table>
</td></tr></table>
</center>
</body>

<!-- Mirrored from www.tutorialspoint.com/dll/dll_writing.htm by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 15 Apr 2013 05:01:32 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
</html>
