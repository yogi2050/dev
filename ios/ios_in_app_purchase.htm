<!doctype html> 
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--><html lang="en"><!--<![endif]-->

<!-- Mirrored from www.tutorialspoint.com/ios/ios_in_app_purchase.htm by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 13 Apr 2013 19:30:59 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8">
<title>iOS - In-App Purchase</title>
<link rel="shortcut icon" href="../favicon.png" type="image/x-icon" />
<meta name="description" content="iOS, Tutorials, Learning, Beginners, Basics, Environment, xCode, Installation, iPhone, Applications, actions and outlets, UI elements, Delegates, Objective-C, Accelerometer, Universal Applications, Camera Management, LocationHandling, SQLite Database, Sending Email, Audio & Video, File Handling, Accessing Maps, In-App Purchase, iAd Integration, GameKit, Storyboards, Auto Layouts, Twitter & Facebook, Memory Management, Application Debugging" />
<meta name="keywords" content="iOS Getting Started-  Learning iPhone and iPad application development on iOS in simple and easy steps using this beginner's tutorial containing basic to advanced knowledge environment setup, actions and outlets, UI elements, Delegates, Objective-C, Accelerometer, Universal Applications, Camera Management, LocationHandling, SQLite Database, Sending Email, Audio & Video, File Handling, Accessing Maps, In-App Purchase, iAd Integration, GameKit, Storyboards, Auto Layouts, Twitter & Facebook, Memory Management, Application Debugging." />
<base  />
<link rel="stylesheet" type="text/css" href="../scripts/style.css" />
<link rel="stylesheet" type="text/css" href="../scripts/prettify.css" />
<script type="text/javascript" src="../scripts/prettify.js"></script>
<style media="screen" type="text/css">
#topmenu a:hover {text-decoration:none;color:#c4c7c8 !important;background-color:transparent;font-weight:bold;}
#header{ 
 background:#c4c7c8 !important;
 background:url(/images/footer.png) repeat-x !important;
}
#topmenu
{
background-color:#353435 !important;
}
#leftcol ul.menu li.heading 
{
   background:#c4c7c8 !important;
   background:url(/images/footer.png) repeat-x !important; 
   border:1px solid #c1c1c1 !important;
}
#leftcol, #middlecol, #rightcol {min-height:1275px; padding:0px;}
</style>
<script src="../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-232293-6";
urchinTracker();
</script>
</head>
<body onload="prettyPrint()">
<div id="header">
<div class="wrapper">
<h1 class="logo"><a href="../index.htm">Tutorials Point - Simply Easy Learning</a></h1>
<div id="search">
<form method="get" id="searchform" name="searchform" action="http://www.google.com/search" target="_blank">
<input type="hidden" name="sitesearch" value="www.tutorialspoint.com"/>
<input type="text" name="as_q" id="s" value="Search this site..." onfocus="if (this.value == 'Search this site...') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search this site...';}"/>
<input value="FORID:11" name="cof" type="hidden"/>
<input type="hidden" name="ie" value="ISO-8859-1" />
<input class="submit btn" type="image" src="../images/icon-search.png" alt="Go"/>
</form>
</div>
</div>
</div>
<div id="topmenu">
<div class="wrapper">
<div id="left">
<a href="../index.htm" target="_top">HOME </a>
<a href="../java/index.htm" target="_top">JAVA </a>
<a href="../php/index.htm" target="_top">PHP </a>
<a href="../python/index.htm" target="_top">Python </a>
<a href="../ruby/index.htm" target="_top">Ruby </a>
<a href="../perl/index.htm" target="_top">Perl </a>
<a href="../html/index.htm" target="_top">HTML </a>
<a href="../css/index.htm" target="_top">CSS </a>
<a href="../javascript/index.htm" target="_top">Javascript </a>
<a href="../mysql/index.htm" target="_top">MySQL </a>
<a href="../cplusplus/index.htm" target="_top">C++ </a>
<a href="../unix/index.htm" target="_top">UNIX </a>
<a href="../more.htm" target="_top">MORE...</a>
</div>
<div id="right">
<a href="../references.htm" target="_top">REFERENCES</a> |
<a href="../forums/index.html" target="_top">FORUM</a> |
<a href="../about/index.htm" target="_top">ABOUT</a> |
<a href="../about/contact_us.htm" target="_top">CONTACT</a>
</div>
</div>
</div>
<div class="wrapper">
<div id="leftcol">
<div class="mini-logo">
<img src="../images/ios-mini-logo.png" alt="iOS Tutorial" />
</div>
<ul class="menu">
<li class="heading">iOS Tutorial</li>
<li><a target="_top" href="index.htm">iOS - Home</a></li>
<li><a target="_top" href="ios_getting_started.htm">iOS - Getting Started</a></li>
<li><a target="_top" href="ios_environment_setup.htm">iOS - Environment Setup</a></li>
<li><a target="_top" href="ios_objective_c.htm">iOS - Objective-C Basics</a></li>
<li><a target="_top" href="ios_first_iphone_application.htm">iOS - First iPhone Application</a></li>
<li><a target="_top" href="ios_actions_and_outlets.htm">iOS - Actions and Outlets</a></li>
<li><a target="_top" href="ios_delegates.htm">iOS - Delegates</a></li>
<li><a target="_top" href="ios_ui_elements.htm">iOS - UI Elements</a></li>
<li><a target="_top" href="ios_accelerometer.htm">iOS - Accelerometer</a></li>
<li><a target="_top" href="ios_universal_applications.htm">ios - Universal Applications</a></li>
<li><a target="_top" href="ios_camera_management.htm">iOS - Camera Management</a></li>
<li><a target="_top" href="ios_location_handling.htm">iOS - Location Handling</a></li>
<li><a target="_top" href="ios_sqlite_database.htm">iOS - SQLite Database</a></li>
<li><a target="_top" href="ios_sending_email.htm">iOS - Sending Email</a></li>
<li><a target="_top" href="ios_audio_video.htm">iOS - Audio &amp; Video</a></li>
<li><a target="_top" href="ios_file_handling.htm">iOS - File Handling</a></li>
<li><a target="_top" href="ios_accessing_maps.htm">iOS - Accessing Maps</a></li>
<li><a target="_top" href="ios_in_app_purchase.htm"><b>iOS - In-App Purchase</b></a></li>
<li><a target="_top" href="ios_iad_integration.htm">iOS - iAd Integration</a></li>
<li><a target="_top" href="ios_gamekit.htm">iOS - GameKit</a></li>
<li><a target="_top" href="ios_storyboards.htm">iOS - Storyboards</a></li>
<li><a target="_top" href="ios_auto_layouts.htm">iOS - Auto Layouts</a></li>
<li><a target="_top" href="ios_twitter_facebook.htm">iOS - Twitter &amp; Facebook</a></li>
<li><a target="_top" href="ios_memory_management.htm">iOS - Memory Management</a></li>
<li><a target="_top" href="ios_application_debugging.htm">iOS - Application Debugging</a></li>
</ul>
<ul class="menu">
<li class="heading">iOS Useful Resources</li>
<li><a target="_top" href="ios_quick_guide.htm">iOS - Quick Guide</a></li>
<li><a target="_top" href="ios_useful_resources.htm">iOS Useful Resources</a></li>
</ul>
<ul class="menu">
<li class="sreading">Selected Reading</li>
<li><a target="_top" href="../developers_best_practices/index.htm">Developer's Best Practices</a></li>
<li><a target="_top" href="../computer_glossary.htm">Computer Glossary</a></li>
<li><a target="_top" href="../computer_whoiswho.htm">Who is Who</a></li>
</ul>
</div><!-- leftcol -->
<div id="middlecol">
<!-- PRINTING STARTS HERE -->
<div class="content">
<h1>iOS - In-App Purchase</h1>
<div class="topgooglead">
<div style="padding-bottom:5px;padding-left:10px;">Advertisements</div>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "image";
google_ad_channel = "";
//--></script>
<script type="text/javascript"
src="../../pagead2.googlesyndication.com/pagead/show_ads.js"> 
</script>
</div>
<hr />
<div class="pre-btn">
<a href="ios_accessing_maps.htm">Previous Page</a>
</div>
<div class="nxt-btn">
<a href="ios_iad_integration.htm">Next Page</a>
</div>
<div class="clearer"></div>
<hr />
<h2>Introduction</h2>

<p>In-App purchase is used purchase additional content or upgrade features with respect to the application.</p>

<h2><p>Steps Involved</p></h2>
<p>1.	In iTunes connect ensure that you have a <b>unique App ID</b> and when we create the application update with the <b>bundle ID</b> and code signing in Xcode with corresponding provisioning profile.</p>
<p>2.	Create a new application and update application information. You can know more about this in apple's <a rel="nofollow" href="http://developer.apple.com/library/ios/#documentation/LanguagesUtilities/Conceptual/iTunesConnect_Guide/8_AddingNewApps/AddingNewApps.html" target="_blank" title="Add new apps">Add new apps</a> documentation.</p>
<p>3.	Add a new product for in-app purchase in <b>Manage In-App Purchase</b> of your application's page.</p>
<p>4.	Ensure you setup the bank details for your application. This needs to be setup for <b>In-App purchase</b> to work. Also create a test user account using <b>Manage Users</b> option in iTunes connect page of your app.</p>
<p>5.	The next steps are related to handling code and creating UI for our In-App purchase.</p>
<p>6.	Create a <b>single view application</b> and enter the bundle identifier is the identifier specified in iTunes connect.</p>
<p>7.	Update the <b>ViewController.xib</b> as shown below.</p>
<p><img src="images/InAppPurchase_OutputInterface.jpg" alt="iOS Tutorial" /></p>
<p>8.	Create <b>IBOutlets</b> for the three labels and the button naming them as productTitleLabel, productDescriptionLabel, productPriceLabel and purchaseButton respectively.</p>
<p>9.	Select your project file, then select targets and then add <b>StoreKit.framework</b>.</p>
<p>10. Update <b>ViewController.h</b> as follows.</p>
<pre class="prettyprint">
#import &lt;UIKit/UIKit.h&gt;
#import &lt;StoreKit/StoreKit.h&gt;

@interface ViewController : UIViewController&lt;
SKProductsRequestDelegate,SKPaymentTransactionObserver&gt;
{
    SKProductsRequest *productsRequest;
    NSArray *validProducts;
    UIActivityIndicatorView *activityIndicatorView;
    IBOutlet UILabel *productTitleLabel;
    IBOutlet UILabel *productDescriptionLabel;
    IBOutlet UILabel *productPriceLabel;
    IBOutlet UIButton *purchaseButton;
}
- (void)fetchAvailableProducts;
- (BOOL)canMakePurchases;
- (void)purchaseMyProduct:(SKProduct*)product;
- (IBAction)purchase:(id)sender;

@end
</pre>
<p>11. Update <b>ViewController.m</b> as follows.</p>
<pre class="prettyprint">
#import "ViewController.h"
#define kTutorialPointProductID 
@"com.tutorialPoints.testApp.testProduct"

@interface ViewController ()

@end

@implementation ViewController

- (void)viewDidLoad
{
    [super viewDidLoad];
    // Adding activity indicator
    activityIndicatorView = [[UIActivityIndicatorView alloc]
    initWithActivityIndicatorStyle:UIActivityIndicatorViewStyleWhiteLarge];
    activityIndicatorView.center = self.view.center;
    [activityIndicatorView hidesWhenStopped];
    [self.view addSubview:activityIndicatorView];
    [activityIndicatorView startAnimating];
    //Hide purchase button initially
    purchaseButton.hidden = YES;
    [self fetchAvailableProducts];    
}

- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

-(void)fetchAvailableProducts{
    NSSet *productIdentifiers = [NSSet 
    setWithObjects:kTutorialPointProductID,nil];
    productsRequest = [[SKProductsRequest alloc] 
    initWithProductIdentifiers:productIdentifiers];
    productsRequest.delegate = self;
    [productsRequest start];
}

- (BOOL)canMakePurchases
{
    return [SKPaymentQueue canMakePayments];
}
- (void)purchaseMyProduct:(SKProduct*)product{
    if ([self canMakePurchases]) {
        SKPayment *payment = [SKPayment paymentWithProduct:product];
        [[SKPaymentQueue defaultQueue] addTransactionObserver:self];
        [[SKPaymentQueue defaultQueue] addPayment:payment];
    }
    else{
        UIAlertView *alertView = [[UIAlertView alloc]initWithTitle:
        @"Purchases are disabled in your device" message:nil delegate:
        self cancelButtonTitle:@"Ok" otherButtonTitles: nil];
        [alertView show];
    }
}
-(IBAction)purchase:(id)sender{
    [self purchaseMyProduct:[validProducts objectAtIndex:0]];
    purchaseButton.enabled = NO; 
}

#pragma mark StoreKit Delegate

-(void)paymentQueue:(SKPaymentQueue *)queue 
 updatedTransactions:(NSArray *)transactions {
    for (SKPaymentTransaction *transaction in transactions) {
        switch (transaction.transactionState) {
            case SKPaymentTransactionStatePurchasing:
                    NSLog(@"Purchasing");
                break;                
            case SKPaymentTransactionStatePurchased:
               if ([transaction.payment.productIdentifier 
                  isEqualToString:kTutorialPointProductID]) {
                   NSLog(@"Purchased ");
                   UIAlertView *alertView = [[UIAlertView alloc]initWithTitle:
                   @"Purchase is completed succesfully" message:nil delegate:
                   self cancelButtonTitle:@"Ok" otherButtonTitles: nil];
                   [alertView show];
                }               
                [[SKPaymentQueue defaultQueue] finishTransaction:transaction];
                break;                
            case SKPaymentTransactionStateRestored:               
                NSLog(@"Restored ");               
                [[SKPaymentQueue defaultQueue] finishTransaction:transaction];
                break;                
            case SKPaymentTransactionStateFailed:
                NSLog(@"Purchase failed ");
                break;
            default:
                break;
        }
    }
}

-(void)productsRequest:(SKProductsRequest *)request 
 didReceiveResponse:(SKProductsResponse *)response
{
    SKProduct *validProduct = nil;
    int count = [response.products count];
    if (count>0) {
        validProducts = response.products;
        validProduct = [response.products objectAtIndex:0];
        if ([validProduct.productIdentifier 
           isEqualToString:kTutorialPointProductID]) {
            [productTitleLabel setText:[NSString stringWithFormat:
            @"Product Title: %@",validProduct.localizedTitle]];
            [productDescriptionLabel setText:[NSString stringWithFormat:
            @"Product Desc: %@",validProduct.localizedDescription]];
            [productPriceLabel setText:[NSString stringWithFormat:
            @"Product Price: %@",validProduct.price]];           
        }        
    } else {
        UIAlertView *tmp = [[UIAlertView alloc]
                            initWithTitle:@"Not Available"
                            message:@"No products to purchase"
                            delegate:self
                            cancelButtonTitle:nil
                            otherButtonTitles:@"Ok", nil];
        [tmp show];
    }    
    [activityIndicatorView stopAnimating];
    purchaseButton.hidden = NO;
}

@end
</pre>
<h2>Note:</h2>
<p>You have to update kTutorialPointProductID to the productID you created for your In-App Purchase. You can add more than one product by updating the  productIdentifiers's NSSet in fetchAvailableProducts. Similary handle purchase related actions for product IDs you add.</p>
<h2>Output</h2>
<p>Now when we run the application we'll get the following output.</p>

<p><img src="images/InAppPurchase_Output1.jpg" alt="iOS Tutorial" /></p>
<p>Ensure you had logged out of your account in settings screen. On clicking Initiate Purchase select Use Existing Apple ID. Enter your valid test account username and password. You will be shown the following alert in a few seconds.</p>
<p><img src="images/InAppPurchase_Output2.jpg" alt="iOS Tutorial" /></p>
<p>Once your product is purchased successfully, you will get the following alert. You can relevant code for updating the application features where we show this alert.</p>
<p><img src="images/InAppPurchase_Output3.jpg" alt="iOS Tutorial" /></p>

<hr />
<div class="pre-btn">
<a href="ios_accessing_maps.htm">Previous Page</a>
</div>
<div class="print-btn">
<a href="../cgi-bin/printpage.html" target="_blank">Print Version</a>
</div>
<div class="nxt-btn">
<a href="ios_iad_integration.htm">Next Page</a>
</div>
<div class="clearer"></div>
<hr />
</div>
<!-- PRINTING ENDS HERE -->
<div class="bottomgooglead">
<div style="padding-bottom:5px;padding-left:10px;">Advertisements</div>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 336;
google_ad_height = 280;
google_ad_format = "336x280_as";
google_ad_type = "text";
google_ad_channel ="9030538898";
google_color_border="ffffff";
google_color_link="900b09";
google_color_url="000000";
google_color_text="000000";
//--></script>
<script type="text/javascript" src="../../pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</div>
</div><!-- middlecol -->
<div id="rightcol">
<!-- AddThis Button BEGIN -->
<div class="addthis">
<div class="addthis_toolbox addthis_default_style">
<a class="addthis_button_facebook"></a>
<a class="addthis_button_twitter"></a>
<script type="text/javascript">
<!--
 document.write('<a class="addthis_button_google_plusone" g:plusone:count="false"></a>');
//-->
</script>
<a class="addthis_button_linkedin"></a>
<a class="addthis_button_email"></a>
<a class="addthis_button_compact"></a>
</div>
<script type="text/javascript" src="../../s7.addthis.com/js/250/addthis_widget.js#pubid=ra-4f661ec623a400f0"></script>
</div>
<!-- AddThis Button END -->
<div class="localad">
<a rel="nofollow" href="http://www.modernindianbabynames.com/" target="_blank" title="Modern Baby Names">Modern Baby Names</a>
</div>
<div class="localad">
<a rel="nofollow" href="http://www.photofuntoos.com/" target="_blank" title="Online Photo Editing">Online Photo Editing</a>
</div>
<div class="rightgooglead">
<div style="padding-bottom:5px;padding-left:10px;">Advertisements</div>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "image";
google_ad_channel ="";
//--></script>
<script type="text/javascript"
src="../../pagead2.googlesyndication.com/pagead/show_ads.js"> 
</script>
</div>
</div><!-- rightcol -->
<div style="clear:both;"></div>
</div><!-- wrapper -->
<div id="footer">
<div class="wrapper">
<div id="bottommenu">
<a href="../asp.net/index.htm" target="_top">ASP.NET </a> |
<a href="../jquery/index.htm" target="_top">jQuery </a> |
<a href="../ajax/index.htm" target="_top">AJAX </a> |
<a href="../ant/index.htm" target="_top">ANT</a> |
<a href="index.htm" target="_top">iOS </a> |
<a href="../servlets/index.htm" target="_top">Servlets </a> |
<a href="../log4j/index.htm" target="_top">log4j </a> |
<a href="../ibatis/index.htm" target="_top">iBATIS </a> |
<a href="../hibernate/index.htm" target="_top">Hibernate </a> |
<a href="../jdbc/index.htm" target="_top">JDBC </a> |
<a href="../struts_2/index.htm" target="_top">Struts </a> |
<a href="../html5/index.htm" target="_top">HTML5 </a> |
<a href="../sql/index.htm" target="_top">SQL </a> |
<a href="../mysql/index.htm" target="_top">MySQL </a> |
<a href="../cplusplus/index.htm" target="_top">C++ </a> |
<a href="../unix/index.htm" target="_top">UNIX </a>
</div>
<div id="copyright">
<p>Copyright &copy; 2013 by tutorialspoint. All Rights Reserved.</p>
</div>
</div>
</div>
</body>

<!-- Mirrored from www.tutorialspoint.com/ios/ios_in_app_purchase.htm by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 13 Apr 2013 19:31:03 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
</html>