<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from www.tutorialspoint.com/unix_system_calls/clone2.htm by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 15 Apr 2013 05:04:03 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>clone() - Unix, Linux System Call</title>
<meta name="Description" Content="clone() - Unix, Linux System Calls Manual Pages (Manpages) ,  Learning fundamentals of UNIX in simple and easy steps : A beginner's tutorial containing complete knowledge of Unix Korn  and Bourne Shell and Programming, Utilities, File System, Directories, Memory Management, Special Variables, vi editor, Processes" />
<meta name="Keywords" content="Unix, Tutorials, Learning, Operating, System, OS, Beginners, Basics, System Calls, Korn, Bourne, Shell,Programming, Utilities, File System, Directories, Memory Management, Special Variables, vi editor, Processes" />
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="cache-control" content="no-cache" />
<base  />
<link rel="stylesheet" type="text/css" href="../tp.css" />
<script src="../../www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-232293-6";
urchinTracker();
</script>
</head>
<body>
<center>
<a name="top"></a>
<table border="0" class="main" cellpadding="2" cellspacing="0">
<tr>
<td class="content" valign="top" align="left">
<a href="../index-2.html"><img src="../images/tp-logo.gif" border="0"  alt="Tutorials Point" /></a>
<br />
<br />
<div  class="search">
<!-- SiteSearch Google -->
<form method="get" action="http://www.google.com/custom" target="google_window">
<table border="0">
<tr><td nowrap="nowrap" valign="top" align="center" height="32">
<a href="http://www.google.com/">
<img src="../../www.google.com/logos/Logo_25wht.gif" border="0" alt="Google" align="middle"></img></a>
</td>
</tr>
<tr>
<td nowrap="nowrap">
<input type="hidden" name="domains" value="www.tutorialspoint.com"></input>
<input type="text" name="q" size="20" maxlength="255" value=""></input>
<input type="submit" name="sa" style="width:20px;font-weight:bold" value="..."></input>
</td></tr>
<tr>
<td nowrap="nowrap">
<table>
<tr>
<td>
<input type="radio" name="sitesearch" value="" checked="checked"></input>
<font size="-1" color="#000000">Web</font>
</td>
<td>
<input type="radio" name="sitesearch" value="www.tutorialspoint.com"></input>
<font size="-1" color="#000000">This Site</font>
</td>
</tr>
</table>
<input type="hidden" name="client" value="pub-7133395778201029"></input>
<input type="hidden" name="forid" value="1"></input>
<input type="hidden" name="ie" value="ISO-8859-1"></input>
<input type="hidden" name="oe" value="ISO-8859-1"></input>
<input type="hidden" name="cof" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:336699;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;FORID:1"></input>
<input type="hidden" name="hl" value="en"></input>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</div>
<br />
&nbsp;&nbsp;<b>Unix for Beginners</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="../unix/index.html">Unix - Home</a></li>
<li><a class="left" target="_top" href="../unix/unix-getting-started.html">Unix - Getting Started</a></li>
<li><a class="left" target="_top" href="../unix/unix-file-management.html">Unix - File Management</a></li>
<li><a class="left" target="_top" href="../unix/unix-directories.html">Unix - Directories</a></li>
<li><a class="left" target="_top" href="../unix/unix-file-permission.html">Unix - File Permission</a></li>
<li><a class="left" target="_top" href="../unix/unix-environment.html">Unix - Environment</a></li>
<li><a class="left" target="_top" href="../unix/unix-basic-utilities.html">Unix - Basic Utilities</a></li>
<li><a class="left" target="_top" href="../unix/unix-pipes-filters.html">Unix - Pipes &amp; Filters</a></li>
<li><a class="left" target="_top" href="../unix/unix-processes.html">Unix - Processes</a></li>
<li><a class="left" target="_top" href="../unix/unix-communication.html">Unix - Communication</a></li>
<li><a class="left" target="_top" href="../unix/unix-vi-editor.html">Unix - The vi Editor</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Unix Shell Programming</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="../unix/unix-shell.html">Unix - What is Shell?</a></li>
<li><a class="left" target="_top" href="../unix/unix-using-variables.html">Unix - Using Variables</a></li>
<li><a class="left" target="_top" href="../unix/unix-special-variables.html">Unix - Special Variables</a></li>
<li><a class="left" target="_top" href="../unix/unix-using-arrays.html">Unix - Using Arrays</a></li>
<li><a class="left" target="_top" href="../unix/unix-basic-operators.html">Unix - Basic Operators</a></li>
<li><a class="left" target="_top" href="../unix/unix-decision-making.html">Unix - Decision Making</a></li>
<li><a class="left" target="_top" href="../unix/unix-shell-loops.html">Unix - Shell Loops</a></li>
<li><a class="left" target="_top" href="../unix/unix-loop-control.html">Unix - Loop Control</a></li>
<li><a class="left" target="_top" href="../unix/unix-shell-substitutions.html">Unix - Shell Substitutions</a></li>
<li><a class="left" target="_top" href="../unix/unix-quoting-mechanisms.html">Unix - Quoting Mechanisms</a></li>
<li><a class="left" target="_top" href="../unix/unix-io-redirections.html">Unix - IO Redirections</a></li>
<li><a class="left" target="_top" href="../unix/unix-shell-functions.html">Unix - Shell Functions</a></li>
<li><a class="left" target="_top" href="../unix/unix-manpage-help.html">Unix - Manpage Help</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Advanced Unix</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="../unix/unix-regular-expressions.html">Unix - Regular Expressions</a></li>
<li><a class="left" target="_top" href="../unix/unix-file-system.html">Unix - File System Basics</a></li>
<li><a class="left" target="_top" href="../unix/unix-user-administration.html">Unix - User Administration</a></li>
<li><a class="left" target="_top" href="../unix/unix-system-performance.html">Unix - System Performance</a></li>
<li><a class="left" target="_top" href="../unix/unix-system-logging.html">Unix - System Logging</a></li>
<li><a class="left" target="_top" href="../unix/unix-signals-traps.html">Unix - Signals and Traps</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Unix Useful References</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="../unix/unix-useful-commands.html">Unix - Useful Commands</a></li>
<li><a class="left" target="_top" href="../unix/unix-quick-guide.html">Unix - Quick Guide</a></li>
<li><a class="left" target="_top" href="../unix/unix-builtin-functions.html">Unix - Builtin Functions</a></li>
<li><a class="left" target="_top" href="index.html"><b>Unix - System Calls</b></a></li>
<li><a class="left" target="_top" href="../unix_commands/index.html">Unix - Commands List</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Unix Useful Resources</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="../unix/unix-useful-resources.html">Unix Useful Resources</a></li>
</ul>
</div>
<br />
&nbsp;&nbsp;<b>Selected Reading</b>
<div  class="left">
<ul class="menu">
<li><a class="left" target="_top" href="../computer_glossary.html">Computer Glossary</a></li>
<li><a class="left" target="_top" href="../computer_whoiswho.html">Who is Who</a></li>
</ul>
</div>
<br /><br />
<small>&copy; 2013 TutorialsPoint.COM </small>
</td>
<td valign="top">
<br /><br />
<table cellpadding="0" cellspacing="0">
<tr valign="middle">
<td  style="width:20px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../index-2.html">Home</a>&nbsp;&nbsp;
</td>
<td  style="width:20px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../references.html">References</a>&nbsp;&nbsp;
</td>
<td  style="width:20px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../forums/index.html">Discussion Forums</a>&nbsp;&nbsp;
</td>
<td  style="width:20px;"></td>
<td  class="top">
&nbsp;&nbsp;<a class="top" href="../about/index.html">About TP</a>&nbsp;&nbsp;
</td>
</tr>
</table>
<table class="middle" cellpadding="5" cellspacing="0">
<tr>
<td>
<!-- PRINTING STARTS HERE -->
<h1>clone() - Unix, Linux System Call</h1>
<hr />
<a href="index.html"><img alt="previous" border="0" src="../images/previous.gif" /></a>
<a href="index.html"><img alt="next" border="0" src="../images/next.gif" /></a>
<!-- AddThis Bookmark Button BEGIN -->
<a href="http://www.addthis.com/bookmark.php" rel="nofollow" onclick="addthis_url   = location.href; addthis_title = document.title; return addthis_click(this);" target="_blank"><img src="../images/add-this.gif" border="0" alt="AddThis Social Bookmark Button" /></a> <script type="text/javascript">var addthis_pub = 'tutorialspoint';</script><script type="text/javascript" src="http://s9.addthis.com/js/widget.php?v=10"></script>
<script type="text/javascript">var addthis_pub = 'tutorialspoint';</script><script type="text/javascript" src="http://s9.addthis.com/js/widget.php?v=10"></script>  
<!-- AddThis Bookmark Button END -->
<br />
<br />
<hr/><div style="padding-bottom:5px;padding-left:10px;">Advertisements</div>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "image";
google_ad_channel = "";
//--></script>
<script type="text/javascript"
  src="../../pagead2.googlesyndication.com/pagead/show_ads.js"> 
</script>
<hr />
<h1 class="manpages">NAME</h1>
<p>clone, __clone2 - create a child process</p>
<h1 class="manpages">SYNOPSIS</h1>
<table class="src" cellpadding="5" cellspacing="5">
<tr><td><pre>
<b>#include &lt;sched.h&gt;</b> 
<p>
<b>int clone(int (*</b><i>fn</i><b>)(void *), void *</b><i>child_stack</i><b>,</b> 
<b>          int </b><i>flags</i><b>, void *</b><i>arg</i><b>, ... </b>  
<b>          /* pid_t *</b><i>pid</i><b>, struct user_desc *</b><i>tls</i> 
", pid_t *" ctid " */ );"
<p>

<b>int __clone2(int (*</b><i>fn</i><b>)(void *),  void *</b><i>child_stack_base</i><b>,</b> 
<b>             size_t </b><i>stack_size</i><b>, int </b><i>flags</i><b>, void *</b><i>arg</i><b>, ...</b> 
<b>             /* pid_t *</b><i>pid</i><b>, struct user_desc *</b><i>tls</i> 
", pid_t *" ctid " */ );"
</pre></td></tr>
</table>
<h1 class="manpages">DESCRIPTION</h1>
<p><b>clone</b>() creates a new process, in a manner similar to <b>fork</b>(2). It is actually a library function layered on top of the underlying  <b>clone</b>() system call, hereinafter referred to as 
<b>sys_clone</b>. A description of <b>sys_clone</b> is given towards the end of this page.</p>
<p>Unlike <b>fork</b>(2), these calls allow the child process to share parts of its execution context with the calling process, such as the memory space, the table of file descriptors, and the table of signal handlers. (Note that on this manual
page, "calling process" normally corresponds to "parent process". But see the description of <b>CLONE_PARENT</b> below.)</p>
<p>The main use of <b>clone</b>() is to implement threads: multiple threads of control in a program that run concurrently in a shared memory space.</p>
<p>When the child process is created with <b>clone</b>(), it executes the function application <i>fn</i>(<i>arg</i>). (This differs from <b>fork</b>(2), where execution continues in the child from the point of the <b>fork</b>(2)
call.) The <i>fn</i> argument is a pointer to a function that is called by the child process at the beginning of its execution. The <i>arg</i> argument is passed to the <i>fn</i> function.</p>
<p>When the <i>fn</i>(<i>arg</i>) function application returns, the child process terminates. The integer returned by <i>fn</i> is the exit code for the child process. The child process may also terminate explicitly by calling
<b>exit</b>(2) or after receiving a fatal signal.</p>
<p>The <i>child_stack</i> argument specifies the location of the stack used by the child process. Since the child and calling process may share memory, it is not possible for the child process to execute in the
same stack as the calling process. The calling process must therefore set up memory space for the child stack and pass a pointer to this space to <b>clone</b>(). Stacks grow downwards on all processors that run Linux
(except the HP PA processors), so <i>child_stack</i> usually points to the topmost address of the memory space set up for the child stack.</p>
<p>The low byte of <i>flags</i> contains the number of the <i>termination signal</i> sent to the parent when the child dies. If this signal is specified as anything other than <b>SIGCHLD</b>, then the parent process must specify the 
<b>__WALL</b> or <b>__WCLONE</b> options when waiting for the child with <b>wait</b>(2). If no signal is specified, then the parent process is not signaled when the child terminates.</p>.
<p><i>flags</i> may also be bitwise-or&#146;ed with zero or more of the following constants, in order to specify what is shared between the calling process and the child process:</p>
<table class="src" cellpadding="5" cellspacing="0" border="1">
<tr><th width="25%">Tag</th><th>Description</th></tr>
<tr><td>
<b>CLONE_PARENT</b> (since Linux 2.3.12) </td><td>
If
<b>CLONE_PARENT</b> is set, then the parent of the new child (as returned by
<b>getppid</b>(2))
will be the same as that of the calling process.
<p>
If
<b>CLONE_PARENT</b> is not set, then (as with
<b>fork</b>(2))
the child&#146;s parent is the calling process.
<p>
Note that it is the parent process, as returned by
<b>getppid</b>(2),
which is signaled when the child terminates, so that
if
<b>CLONE_PARENT</b> is set, then the parent of the calling process, rather than the
calling process itself, will be signaled.
</td></tr>
<tr><td>
<b>CLONE_FS</b> </td><td>
If
<b>CLONE_FS</b> is set, the caller and the child processes share the same file system
information.
This includes the root of the file system, the current
working directory, and the umask.
Any call to
<b>chroot</b>(2),
<b>chdir</b>(2),
or
<b>umask</b>(2)
performed by the calling process or the child process also affects the
other process.
<p>
If
<b>CLONE_FS</b> is not set, the child process works on a copy of the file system
information of the calling process at the time of the
<b>clone</b>() call.
Calls to
<b>chroot</b>(2),
<b>chdir</b>(2),
<b>umask</b>(2)
performed later by one of the processes do not affect the other process.
</td></tr>
<tr><td>
<b>CLONE_FILES</b> </td><td>
If
<b>CLONE_FILES</b> is set, the calling process and the child processes share the same file
descriptor table.
Any file descriptor created by the calling process or by the child
process is also valid in the other process.
Similarly, if one of the processes closes a file descriptor,
or changes its associated flags (using the
<b>fcntl</b>(2)
<b>F_SETFD</b> operation), the other process is also affected.
<p>
If
<b>CLONE_FILES</b> is not set, the child process inherits a copy of all file descriptors
opened in the calling process at the time of
<b>clone</b>(). (The duplicated file descriptors in the child refer to the
same open file descriptions (see
<b>open</b>(2))
as the corresponding file descriptors in the calling process.)
Subsequent operations that open or close file descriptors,
or change file descriptor flags,
performed by either the calling
process or the child process do not affect the other process.
</td></tr>
<tr><td>
<b>CLONE_NEWNS</b> (since Linux 2.4.19) </td><td>
Start the child in a new namespace.
<p>
Every process lives in a namespace.
The
<i>namespace</i> of a process is the data (the set of mounts) describing the file hierarchy
as seen by that process.
After a
<b>fork</b>(2)
or
<b>clone</b>(2)
where the
<b>CLONE_NEWNS</b> flag is not set, the child lives in the same namespace as the parent.
The system calls
<b>mount</b>(2)
and
<b>umount</b>(2)
change the namespace of the calling process, and hence affect
all processes that live in the same namespace, but do not affect
processes in a different namespace.
<p>
After a
<b>clone</b>(2)
where the
<b>CLONE_NEWNS</b> flag is set, the cloned child is started in a new namespace,
initialized with a copy of the namespace of the parent.
<p>
Only a privileged process (one having the CAP_SYS_ADMIN capability)
may specify the
<b>CLONE_NEWNS</b> flag.
It is not permitted to specify both
<b>CLONE_NEWNS</b> and
<b>CLONE_FS</b> in the same
<b>clone</b>() call.
</td></tr>
<tr><td>
<b>CLONE_SIGHAND</b> </td><td>
If
<b>CLONE_SIGHAND</b> is set, the calling process and the child processes share the same table of
signal handlers.
If the calling process or child process calls
<b>sigaction</b>(2)
to change the behavior associated with a signal, the behavior is
changed in the other process as well.
However, the calling process and child
processes still have distinct signal masks and sets of pending
signals.
So, one of them may block or unblock some signals using
<b>sigprocmask</b>(2)
without affecting the other process.
<p>
If
<b>CLONE_SIGHAND</b> is not set, the child process inherits a copy of the signal handlers
of the calling process at the time
<b>clone</b>() is called.
Calls to
<b>sigaction</b>(2)
performed later by one of the processes have no effect on the other
process.
<p>
Since Linux 2.6.0-test6,
<i>flags</i> must also include
<b>CLONE_VM</b> if
<b>CLONE_SIGHAND</b> is specified
</td></tr>
<tr><td>
<b>CLONE_PTRACE</b> </td><td>
If
<b>CLONE_PTRACE</b> is specified, and the calling process is being traced,
then trace the child also (see
<b>ptrace</b>(2)).
</td></tr>
<tr><td>
<b>CLONE_UNTRACED</b> (since Linux 2.5.46) </td><td>
If
<b>CLONE_UNTRACED</b> is specified, then a tracing process cannot force
<b>CLONE_PTRACE</b> on this child process.
</td></tr>
<tr><td>
<b>CLONE_STOPPED</b> (since Linux 2.6.0-test2) </td><td>
If
<b>CLONE_STOPPED</b> is set, then the child is initially stopped (as though it was sent a
<b>SIGSTOP</b> signal), and must be resumed by sending it a
<b>SIGCONT</b> signal.
</td></tr>
<tr><td>
<b>CLONE_VFORK</b> </td><td>
If
<b>CLONE_VFORK</b> is set, the execution of the calling process is suspended
until the child releases its virtual memory
resources via a call to
<b>execve</b>(2)
or
<b>_exit</b>(2)
(as with
<b>vfork</b>(2)).
<p>
If
<b>CLONE_VFORK</b> is not set then both the calling process and the child are schedulable
after the call, and an application should not rely on execution occurring
in any particular order.
</td></tr>
<tr><td>
<b>CLONE_VM</b> </td><td>
If
<b>CLONE_VM</b> is set, the calling process and the child processes run in the same memory
space.
In particular, memory writes performed by the calling process
or by the child process are also visible in the other process.
Moreover, any memory mapping or unmapping performed with
<b>mmap</b>(2)
or
<b>munmap</b>(2)
by the child or calling process also affects the other process.
<p>
If
<b>CLONE_VM</b> is not set, the child process runs in a separate copy of the memory
space of the calling process at the time of
<b>clone</b>(). Memory writes or file mappings/unmappings performed by one of the
processes do not affect the other, as with
<b>fork</b>(2).
</td></tr>
<tr><td>
<b>CLONE_PID</b> (obsolete) </td><td>
If
<b>CLONE_PID</b> is set, the child process is created with the same process ID as
the calling process.
This is good for hacking the system, but otherwise
of not much use.
Since 2.3.21 this flag can be
specified only by the system boot process (PID 0).
It disappeared in Linux 2.5.16.
</td></tr>
<tr><td>
<b>CLONE_THREAD</b> (since Linux 2.4.0-test8) </td><td>
If
<b>CLONE_THREAD</b> is set, the child is placed in the same thread group as the calling process.
To make the remainder of the discussion of
<b>CLONE_THREAD</b> more readable, the term "thread" is used to refer to the
processes within a thread group.
<p>
Thread groups were a feature added in Linux 2.4 to support the
POSIX threads notion of a set of threads that share a single PID.
Internally, this shared PID is the so-called
thread group identifier (TGID) for the thread group.
Since Linux 2.4, calls to
<b>getpid</b>(2)
return the TGID of the caller.
<p>
The threads within a group can be distinguished by their (system-wide)
unique thread IDs (TID).
A new thread&#146;s TID is available as the function result
returned to the caller of
<b>clone</b>(), and a thread can obtain
its own TID using
<b>gettid</b>(2).
<p>
When a call is made to
<b>clone</b>() without specifying
<b>CLONE_THREAD</b>, then the resulting thread is placed in a new thread group
whose TGID is the same as the thread&#146;s TID.
This thread is the
<i>leader</i> of the new thread group.
<p>
A new thread created with
<b>CLONE_THREAD</b> has the same parent process as the caller of
<b>clone</b>() (i.e., like
<b>CLONE_PARENT</b>), so that calls to
<b>getppid</b>(2)
return the same value for all of the threads in a thread group.
When a
<b>CLONE_THREAD</b> thread terminates, the thread that created it using
<b>clone</b>() is not sent a
<b>SIGCHLD</b> (or other termination) signal;
nor can the status of such a thread be obtained
using
<b>wait</b>(2).
(The thread is said to be
<i>detached</i>.) <p>
After all of the threads in a thread group terminate
the parent process of the thread group is sent a
<b>SIGCHLD</b> (or other termination) signal.
<p>
If any of the threads in a thread group performs an
<b>execve</b>(2),
then all threads other than the thread group leader are terminated,
and the new program is executed in the thread group leader.
<p>
If one of the threads in a thread group creates a child using
<b>fork</b>(2),
then any thread in the group can
<b>wait</b>(2)
for that child.
<p>
Since Linux 2.5.35,
<i>flags</i> must also include
<b>CLONE_SIGHAND</b> if
<b>CLONE_THREAD</b> is specified.
<p>
Signals may be sent to a thread group as a whole (i.e., a TGID) using
<b>kill</b>(2),
or to a specific thread (i.e., TID) using
<b>tgkill</b>(2).
<p>
Signal dispositions and actions are process-wide:
if an unhandled signal is delivered to a thread, then
it will affect (terminate, stop, continue, be ignored in)
all members of the thread group.
<p>
Each thread has its own signal mask, as set by
<b>sigprocmask</b>(2),
but signals can be pending either: for the whole process
(i.e., deliverable to any member of the thread group),
when sent with
<b>kill</b>(2);
or for an individual thread, when sent with
<b>tgkill</b>(2).
A call to
<b>sigpending</b>(2)
returns a signal set that is the union of the signals pending for the
whole process and the signals that are pending for the calling thread.
<p>
If
<b>kill</b>(2)
is used to send a signal to a thread group,
and the thread group has installed a handler for the signal, then
the handler will be invoked in exactly one, arbitrarily selected
member of the thread group that has not blocked the signal.
If multiple threads in a group are waiting to accept the same signal using
<b>sigwaitinfo</b>(2),
the kernel will arbitrarily select one of these threads
to receive a signal sent using
<b>kill</b>(2).
</td></tr>
<tr><td>
<b>CLONE_SYSVSEM</b> (since Linux 2.5.10) </td><td>
If
<b>CLONE_SYSVSEM</b> is set, then the child and the calling process share
a single list of System V semaphore undo values (see
<b>semop</b>(2)).
If this flag is not set, then the child has a separate undo list,
which is initially empty.
</td></tr>
<tr><td>
<b>CLONE_SETTLS</b> (since Linux 2.5.32) </td><td>
The
<i>newtls</i> parameter is the new TLS (Thread Local Storage) descriptor.
(See
<b>set_thread_area</b>(2).)
</td></tr>
<tr><td>
<b>CLONE_PARENT_SETTID</b> (since Linux 2.5.49) </td><td>
Store child thread ID at location
<i>parent_tidptr</i> in parent and child memory.
(In Linux 2.5.32-2.5.48 there was a flag CLONE_SETTID that did this.)
</td></tr>
<tr><td>
<b>CLONE_CHILD_SETTID</b> (since Linux 2.5.49) </td><td>
Store child thread ID at location
<i>child_tidptr</i> in child memory.
</td></tr>
<tr><td>
<b>CLONE_CHILD_CLEARTID</b> (since Linux 2.5.49) </td><td>
Erase child thread ID at location
<i>child_tidptr</i> in child memory when the child exits, and do a wakeup on the futex
at that address.
The address involved may be changed by the
<b>set_tid_address</b>(2)
system call.
This is used by threading libraries.
</td></tr>
</table>
<h2><i>sys_clone</i></h2>
The
<b>sys_clone</b> system call corresponds more closely to
<b>fork</b>(2)
in that execution in the child continues from the point of the
call.
Thus,
<b>sys_clone</b> only requires the
<i>flags</i> and
<i>child_stack</i> arguments, which have the same meaning as for
<b>clone</b>(). (Note that the order of these arguments differs from
<b>clone</b>().) <p>
Another difference for
<b>sys_clone</b> is that the
<i>child_stack</i> argument may be zero, in which case copy-on-write semantics ensure that the
child gets separate copies of stack pages when either process modifies
the stack.
In this case, for correct operation, the
<b>CLONE_VM</b> option should not be specified.
<p>
Since Linux 2.5.49 the system call has five parameters.
The two new parameters are
<i>parent_tidptr</i> which points to the location (in parent and child memory) where
the child thread ID will be written in case CLONE_PARENT_SETTID
was specified, and
<i>child_tidptr</i> which points to the location (in child memory) where the child thread ID
will be written in case CLONE_CHILD_SETTID was specified.
<h1 class="manpages">RETURN VALUE</h1>
On success, the thread ID of the child process is returned
in the caller&#146;s thread of execution.
On failure, a -1 will be returned
in the caller&#146;s context, no child process will be created, and
<i>errno</i> will be set appropriately.
<h1 class="manpages">ERRORS</h1>
<table class="src" cellpadding="5" cellspacing="0" border="1">
<tr><th width="25%">Tag</th><th>Description</th></tr>
<tr valign="top"><td>
<b>EAGAIN</b> </td><td valign="bottom">
Too many processes are already running.
</td></tr>
<tr valign="top"><td>
<b>EINVAL</b> </td><td valign="bottom">
<b>CLONE_SIGHAND</b> was specified, but
<b>CLONE_VM</b> was not.
(Since Linux 2.6.0-test6.)
</td></tr>
<tr valign="top"><td>
<b>EINVAL</b> </td><td valign="bottom">
<b>CLONE_THREAD</b> was specified, but
<b>CLONE_SIGHAND</b> was not. (Since Linux 2.5.35.)
</td></tr>
<tr valign="top"><td>
<b>EINVAL</b> </td><td valign="bottom">
Both
<b>CLONE_FS</b> and
<b>CLONE_NEWNS</b> were specified in
<i>flags</i>. </td></tr>
<tr valign="top"><td>
<b>EINVAL</b> </td><td valign="bottom">
Returned by
<b>clone</b>() when a zero value is specified for
<i>child_stack</i>. </td></tr>
<tr valign="top"><td>
<b>ENOMEM</b> </td><td valign="bottom">
Cannot allocate sufficient memory to allocate a task structure for the
child, or to copy those parts of the caller&#146;s context that need to be
copied.
</td></tr>
<tr valign="top"><td>
<b>EPERM</b> </td><td valign="bottom">
<b>CLONE_NEWNS</b> was specified by a non-root process (process without CAP_SYS_ADMIN).
</td></tr>
<tr valign="top"><td>
<b>EPERM</b> </td><td valign="bottom">
<b>CLONE_PID</b> was specified by a process other than process 0.
</td></tr>
</table>
<h1 class="manpages">VERSIONS</h1>
<p>There is no entry for <b>clone</b>() in libc5. glibc2 provides <b>clone</b>() as described in this manual page.</p>
<h1 class="manpages">CONFORMING TO</h1>
<p>The <b>clone</b>() and <b>sys_clone</b> calls are Linux specific and should not be used in programs intended to be portable.</p>
<h1 class="manpages">NOTES</h1>
<p>In the kernel 2.4.x series, <b>CLONE_THREAD</b> generally does not make the parent of the new thread the same as the parent of the calling process. However, for kernel versions 2.4.7 to 2.4.18 the <b>CLONE_THREAD</b> flag implied the
<b>CLONE_PARENT</b> flag (as in kernel 2.6). </p>
<p>For a while there was <b>CLONE_DETACHED</b> (introduced in 2.5.32): parent wants no child-exit signal. In 2.6.2 the need to give this together with <b>CLONE_THREAD</b> disappeared. This flag is still defined, but has no effect. On x86, <b>clone</b>() should not be called through vsyscall, but directly through <i>int $0x80</i>. On IA-64, a different system call is used:</p>
<table class="src" cellpadding="5" cellspacing="5">
<tr><td><pre>
<p>
<b>int __clone2(int (*</b><i>fn</i><b>)(void *),  void *</b><i>child_stack_base</i><b>,</b> 
<b>             size_t </b><i>stack_size</i><b>, int </b><i>flags</i><b>, void *</b><i>arg</i><b>, ...</b> 
<b>             /* pid_t *</b><i>pid</i><b>, struct user_desc *</b><i>tls</i> 
", pid_t *" ctid " */ );"
</pre></td></tr>
</table>
<p>The <b>__clone2</b>() system call operates in the same way as <b>clone</b>(), except that  <i>child_stack_base</i> points to the lowest address of the child&#146;s stack area, and
<i>stack_size</i> specifies the size of the stack pointed to by <i>child_stack_base</i>.</p>
<h1 class="manpages">BUGS</h1>
<p>Versions of the GNU C library that include the NPTL threading library contain a wrapper function for <b>getpid</b>(2) that performs caching of PIDs. In programs linked against such libraries, calls to
<b>getpid</b>(2) may return the same value, even when the threads were not created using <b>CLONE_THREAD</b> (and thus are not in the same thread group). To get the truth, it may be necessary to use code such as the following</p>
<table class="src" cellpadding="5" cellspacing="5">
<tr><td><pre>
#include &lt;syscall.h&gt;

pid_t mypid;

mypid = syscall(SYS_getpid);
</pre></td></tr>
</table>
<h1 class="manpages">SEE ALSO</h1>
<ul>
<li><p><a href="fork.htm">fork (2)</a></p></li>
<li><p><a href="futex.htm">futex (2)</a></p></li>
<li><p><a href="getpid.htm">getpid (2)</a></p></li>
<li><p><a href="gettid.htm">gettid (2)</a></p></li>
<li><p><a href="set_thread_area.htm">set_thread_area (2)</a></p></li>
<li><p><a href="set_tid_address.htm">set_tid_address (2)</a></p></li>
<li><p><a href="tkill.htm">tkill (2)</a></p></li>
<li><p><a href="unshare.htm">unshare (2)</a></p></li>
<li><p><a href="wait.htm">wait (2)</a></p></li>
</ul>
<br />
<hr />
<a href="index.html"><img alt="previous" border="0" src="../images/previous.gif" /></a>
<a href="index.html"><img alt="next" border="0" src="../images/next.gif" /></a>
<a href='../cgi-bin/printversionf222.html?tutorial=unix_system_calls&amp;file=clone.htm' target="_blank">
<img src="../images/print.gif" alt="Printer Friendly" border="0" /></a>
<br />
<hr />
<!-- PRINTING ENDS HERE -->
<div style="padding-bottom:5px;padding-left:10px;">Advertisements</div>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 336;
google_ad_height = 280;
google_ad_format = "336x280_as";
google_ad_type = "text_image";
google_ad_channel ="9030538898";
google_color_border="ffffff";
google_color_link="900b09";
google_color_url="000000";
google_color_text="000000";
//--></script>
<script type="text/javascript" src="../../pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</td></tr>
</table>
</td>
<td class="right" align="center" valign="top">
<br /><br />
<table width="100%" cellpadding="0" cellspacing="0">
<tr valign="middle">
<td  class="top" style="border:0px;">
&nbsp;&nbsp;
</td>
</tr>
</table>
<table class="right"  cellpadding="0" cellspacing="0">
<tr>
<td align="center" class="right">
<p>
<u>Advertisements</u>
</p>
<script type="text/javascript"><!--
google_ad_client = "pub-7133395778201029";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "image";
google_ad_channel ="";
//--></script>
<script type="text/javascript"
  src="../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<br /><br /></td></tr></table>
</td></tr></table>
</center>
</body>

<!-- Mirrored from www.tutorialspoint.com/unix_system_calls/clone2.htm by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 15 Apr 2013 05:04:03 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
</html>
